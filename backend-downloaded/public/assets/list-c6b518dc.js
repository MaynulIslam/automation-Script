import{j as e,N as ne,O as se,q as c,s as re,r as d,S as y,bV as ke,bW as Ce,bX as Ae,bZ as Te,M as I,bb as Se,bU as De,I as Pe,w as f,y as le,c7 as Re,B as $,_,ao as G,P as Ie,bv as Ee,bc as M,aG as K,T as oe,c8 as Fe,f as q,aA as Le,az as A,aC as H,aD as Y,Y as We,V as X,aE as ie,aZ as P,ay as Oe,aB as W,m as O,aw as ce,bP as de,b as Be,Q as Me,e as Ve,d as Ne,aN as _e,U as ze,bF as $e,bH as He,X as Qe,D as Z,ar as ee,aJ as qe,aK as Ge,c9 as Ue,bJ as Je,aq as Ke,ca as Ye,as as Xe,at as Ze,au as ea,bM as aa,bN as ta,av as na,bO as sa,cb as z,W as ra}from"./index-b5422eae.js";import{s as Q}from"./sumBy-177e2243.js";import"./invoice-analytic-c981246e.js";import{D as ae}from"./DateTimePicker-537bd9ba.js";import"./_baseIteratee-8de60f2f.js";import"./_baseToString-ddfaf6f7.js";function la({color:a="currentColor",size:i=24}){return e.jsxs("svg",{width:i,height:i,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",stroke:a,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M14 2v6h6",stroke:a,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"m9 15 2 2 4-4",stroke:a,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}async function oa(){try{let a=`${ne.sensorAlarm.getSensorAlarmData}`,i=await se.get(a);return console.log("data.response------->",i),i.sensorAlarm}catch(a){throw console.error("error",a),a}}async function ia(a,i){try{let g=`${ne.sensorAlarm.updateSensorAlarm}/${a}`;return(await se.put(g,i)).response.sensorAlarm}catch(g){throw console.error("error",g),g}}c.func,c.func,c.func,c.func,c.object,c.bool;function ue({filters:a,onFilters:i,dateError:g,serviceOptions:x,deviceOption:n}){const h=re(),j=d.useCallback(r=>{i("name",r.target.value)},[i]);d.useCallback(r=>{i("service",typeof r.target.value=="string"?r.target.value.split(","):r.target.value)},[i]);const o=d.useCallback(r=>{i("device",typeof r.target.value=="string"?r.target.value.split(","):r.target.value)},[i]),b=d.useCallback(r=>{i("startDate",r)},[i]),m=d.useCallback(r=>{i("endDate",r)},[i]);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsxs(ke,{sx:{flexShrink:0,width:{xs:1,md:180}},children:[e.jsx(Ce,{children:"Device"}),e.jsx(Ae,{multiple:!0,value:a.device,onChange:o,input:e.jsx(Te,{label:"Device"}),renderValue:r=>r.map(t=>t).join(", "),sx:{textTransform:"capitalize"},children:n.map(r=>e.jsxs(I,{value:r.value,children:[e.jsx(Se,{disableRipple:!0,color:"default",size:"small",checked:a.device.includes(r.value)}),e.jsx("span",{dangerouslySetInnerHTML:{__html:r.label}})]},r.value))})]}),e.jsx(ae,{label:"Start date",value:a.startDate,onChange:b,slotProps:{textField:{fullWidth:!0}},sx:{maxWidth:{md:180}}}),e.jsx(ae,{label:"End date",value:a.endDate,onChange:m,slotProps:{textField:{fullWidth:!0,error:g}},sx:{maxWidth:{md:180}}}),e.jsx(y,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:e.jsx(De,{fullWidth:!0,value:a.name,onChange:j,placeholder:"Search ...",InputProps:{startAdornment:e.jsx(Pe,{position:"start",children:e.jsx(f,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})]}),e.jsxs(le,{open:h.open,onClose:h.onClose,arrow:"right-top",sx:{width:140},children:[e.jsxs(I,{onClick:()=>{h.onClose()},children:[e.jsx(f,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(I,{onClick:()=>{h.onClose()},children:[e.jsx(f,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(I,{onClick:()=>{h.onClose()},children:[e.jsx(f,{icon:"solar:export-bold"}),"Export"]})]})]})}ue.propTypes={dateError:c.bool,filters:c.object,onFilters:c.func,serviceOptions:c.array};function he({filters:a,onFilters:i,onResetFilters:g,results:x,...n}){const h=Re(a.startDate,a.endDate),j=r=>{const t=a.service.filter(u=>u!==r);i("service",t)},o=()=>{i("status","all")},b=()=>{i("startDate",null),i("endDate",null)},m=r=>{const t=a.device.filter(u=>u!==r);i("device",t)};return e.jsxs(y,{spacing:1.5,...n,children:[e.jsxs($,{sx:{typography:"body2"},children:[e.jsx("strong",{children:x}),e.jsx($,{component:"span",sx:{color:"text.secondary",ml:.25},children:"results found"})]}),e.jsxs(y,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!a.service.length&&e.jsx(B,{label:"Service:",children:a.service.map(r=>e.jsx(_,{label:r,size:"small",onDelete:()=>j(r)},r))}),!!a.device.length&&e.jsx(B,{label:"Device:",children:a.device.map(r=>e.jsx(_,{label:r,size:"small",onDelete:()=>m(r)},r))}),a.status!=="all"&&e.jsx(B,{label:"Status:",children:e.jsx(_,{size:"small",label:a.status,onDelete:o})}),a.startDate&&a.endDate&&e.jsx(B,{label:"Date:",children:e.jsx(_,{size:"small",label:h,onDelete:b})}),e.jsx(G,{color:"error",onClick:g,startIcon:e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]})]})}he.propTypes={filters:c.object,onFilters:c.func,onResetFilters:c.func,results:c.number};function B({label:a,children:i,sx:g,...x}){return e.jsxs(y,{component:Ie,variant:"outlined",spacing:1,direction:"row",sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...g},...x,children:[e.jsx($,{component:"span",sx:{typography:"subtitle2"},children:a}),e.jsx(y,{spacing:1,direction:"row",flexWrap:"wrap",children:i})]})}B.propTypes={children:c.node,label:c.string,sx:c.object};function R({title:a,total:i,icon:g,color:x,percent:n,price:h,onClick:j,selectedFilter:o}){const[b,m]=d.useState(!1),[r,t]=d.useState(!1),u=()=>{j&&j(),t(!0),setTimeout(()=>t(!1),300)};return d.useEffect(()=>{m(o==="all"&&a==="Total"||o==="warning"&&a==="Warning"||o==="alarm"&&a==="Alarm"||o==="archived"&&a==="Archived"?!0:o==="acknowledged"&&a==="Acknowledged")},[o]),e.jsxs(y,{spacing:2.5,direction:"row",alignItems:"center",justifyContent:"center",sx:{width:1,minWidth:200,cursor:"pointer",transition:"all 0.3s ease",transform:r?"scale(1.05)":"scale(1)"},onClick:u,children:[e.jsxs(y,{alignItems:"center",justifyContent:"center",sx:{position:"relative"},children:[e.jsx(Ee,{src:`/assets/icons/home/ic_${g}.svg`,width:32,sx:{color:b?x:M(x,1),position:"absolute"}}),e.jsx(K,{variant:"determinate",value:n,size:56,thickness:2,sx:{color:b?x:M(x,1)}}),e.jsx(K,{variant:"determinate",value:100,size:56,thickness:3,sx:{top:0,left:0,opacity:.48,position:"absolute",color:w=>M(w.palette.grey[500],.16)}})]}),e.jsxs(y,{spacing:.5,children:[e.jsx(oe,{variant:"subtitle1",sx:{color:b?"primary.main":"common.white"},children:`${Fe(i)||0} ${i>0?"Records":"Record"}`}),e.jsx($,{component:"span",sx:{color:b?"primary.main":"text.disabled",typography:"body2"},children:a})]})]})}R.propTypes={color:c.string,icon:c.oneOfType([c.element,c.string]),percent:c.number,price:c.number,title:c.string,total:c.number,onClick:c.func,selectedFilter:c.string};function pe({row:a,selected:i,onSelectRow:g,onViewRow:x,onEditRow:n,onDeleteRow:h}){const{id:j,acknowledged:o,alarm_message:b,value:m,unit:r,status:t,createdAt:u,device:w,device_sensor_master:l,duration:k,updatedAt:C}=a,T=q(),S=re();return e.jsxs(e.Fragment,{children:[e.jsxs(Le,{hover:!0,children:[e.jsx(A,{children:e.jsx(H,{disableTypography:!0,primary:e.jsx(Y,{noWrap:!0,color:"inherit",variant:"subtitle2",href:`http://${w.ip_address}/`,target:"_blank",rel:"noopener noreferrer",sx:{cursor:"context-menu",display:"flex",alignItems:"center"},children:w.device_name}),secondary:e.jsx(We,{component:"span",sx:{typography:"body2",color:"text.disabled"},children:w.ip_address})})}),e.jsx(A,{children:u&&e.jsx(H,{primary:X(new Date(u),"dd MMM yyyy"),secondary:X(new Date(u),"h:mm:ss a"),primaryTypographyProps:{typography:"body2",noWrap:!0},secondaryTypographyProps:{mt:.5,component:"span",typography:"caption"}})}),e.jsx(A,{align:"center",children:e.jsx(ie,{variant:"soft",color:t==="normal"&&"success"||t==="warning"&&"warning"||t==="alarm"&&"error"||"default",children:t})}),e.jsx(A,{sx:{display:"flex",alignItems:"center"},children:l&&e.jsx(H,{disableTypography:!0,primary:e.jsxs(oe,{variant:"body2",noWrap:!0,children:[(l==null?void 0:l.config_type)==1||(l==null?void 0:l.config_type)==3||(l==null?void 0:l.config_type)==4?P[Object.keys(P).find(D=>P[D].id===(l==null?void 0:l.config_type))].label:""," Â ",l.sensor_type?Oe(l.sensor_type).short_name:""]}),secondary:e.jsxs(Y,{noWrap:!0,variant:"body2",sx:{color:"text.disabled",cursor:"pointer"},children:[l.config_type==1||l.config_type==3||l.config_type==4&&(l!=null&&l.location)?l==null?void 0:l.location:null,(l==null?void 0:l.config_type)===2&&(l!=null&&l.sensor_type)?l.location:""]})})}),e.jsx(A,{children:(l==null?void 0:l.config_type)&&e.jsxs(e.Fragment,{children:[P[Object.keys(P).find(D=>P[D].id===(l==null?void 0:l.config_type))].label," Sensor",e.jsx("br",{}),b]})}),e.jsxs(A,{align:"center",children:[m||0," ",r||"ppm"]}),e.jsxs(A,{align:"center",children:[k>=36e5&&`${Math.floor(k/36e5)} hrs `,Math.floor(k%36e5/6e4)," mins",Math.floor(k%6e4/1e3)>0?` ${Math.floor(k%6e4/1e3)} secs`:""]}),e.jsx(A,{align:"center",sx:{px:1,display:"table-cell",verticalAlign:"middle"},children:e.jsx(W,{title:o?"Acknowledged":"Not Acknowledged",children:e.jsx(O,{onClick:o?void 0:x,color:o?"success":"warning",sx:{display:"flex",p:1,m:"auto"},children:e.jsx(la,{})})})})]}),e.jsxs(le,{open:S.open,onClose:S.onClose,arrow:"right-top",sx:{width:160},children:[e.jsxs(I,{onClick:()=>{n(),S.onClose()},children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]}),e.jsx(ce,{sx:{borderStyle:"dashed"}}),e.jsxs(I,{onClick:()=>{T.onTrue(),S.onClose()},sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]}),e.jsx(de,{open:T.value,onClose:T.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(G,{variant:"contained",color:"error",onClick:h,children:"Delete"})})]})}pe.propTypes={onDeleteRow:c.func,onEditRow:c.func,onSelectRow:c.func,onViewRow:c.func,row:c.object,selected:c.bool};const ca=[{id:"alarmList_station_name",label:"Station Name"},{id:"createDate",label:"Timestamp"},{id:"alarmType",label:"Alarm",align:"center"},{id:"sensorType",label:"Sensor"},{id:"sensorType",label:"Description"},{id:"alarmlistvalue",label:"Value",align:"center"},{id:"price",label:"Duration",align:"center"},{id:"status2",label:"Acknowledged",align:"center"}],te={name:"",service:[],device:[],status:"all",startDate:null,endDate:null};function da(){const a=Be(),i=Me(),g=Ve(),{enqueueSnackbar:x}=Ne(),n=_e({defaultOrderBy:"createDate",defaultRowsPerPage:10}),h=q();q();let j=ze(["maestrolink/alarms/keyfigures"]);d.useState(null);const[o,b]=d.useState([]);d.useState([]);const[m,r]=d.useState(null);d.useState(null);const[t,u]=d.useState(te),[w,l]=d.useState(null),k=t.startDate&&t.endDate?t.startDate.getTime()>t.endDate.getTime():!1,C=ua({inputData:o,comparator:$e(n.order,n.orderBy),filters:t,dateError:k}),T=C.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage),S=n.dense?56:76,D=!!t.name||!!t.service.length||!!t.device.length||t.status!=="all"||!!t.startDate&&!!t.endDate,ge=!C.length&&D||!C.length,v=s=>s==="acknowledged"?o.filter(p=>p.acknowledged===1).length:o.filter(p=>p.status===s).length,V=s=>s==="acknowledged"?Q(o.filter(p=>p.acknowledged===1),"totalAmount"):Q(o.filter(p=>p.status===s),"totalAmount"),N=s=>v(s)/o.length*100,xe=[{value:"all",label:"All",color:"default",count:o.length},{value:"warning",label:"Warning",color:"warning",count:v("warning")},{value:"alarm",label:"Alarm",color:"error",count:v("alarm")},{value:"archived",label:"Archived",color:"default",count:v("archived")},{value:"acknowledged",label:"Acknowledged",color:"success",count:v("acknowledged")}],E=d.useCallback((s,p)=>{n.onResetPage(),u(L=>({...L,[s]:p}))},[n]),me=d.useCallback(s=>{const p=o.filter(L=>L.id!==s);b(p),n.onUpdatePageDeleteRow(T.length)},[T.length,n,o]),je=d.useCallback(s=>{g.push(He.dashboard.invoice.edit(s))},[g]),be=d.useCallback((s,p)=>{E("status",p)},[E]),we=d.useCallback(()=>{u(te)},[]),U=async()=>{let s=await oa();b(s)},fe=async s=>{l(s),h.onTrue()},ye=d.useCallback(async s=>{try{await ia(w,{acknowledged:1,alarm_message:"Acknowledged",status:"archived"}),x("Acknowledged alarm.",{variant:"success"}),U()}catch(p){console.error("error",p),x("Error occurred while acknowledged alarm.",{variant:"error"})}},[C.length,T.length,n,o]);d.useEffect(()=>{U()},[]),d.useEffect(()=>{if(!j)return;const s=(p,L)=>{let J;try{J=JSON.parse(L)}catch(ve){console.error("Failed to parse MQTT message",ve);return}p==="maestrolink/alarms/keyfigures"?r(J):console.log("Unknown topic:",p)};return j.on("message",s),()=>{j.removeListener("message",s),j.end(()=>{console.log("MQTT client disconnected")})}},[j]);const F=s=>{E("status",s)};return e.jsxs(e.Fragment,{children:[e.jsxs(Qe,{maxWidth:i.themeStretch?!1:"xl",children:[e.jsx(Z,{sx:{mb:{xs:3,md:5}},children:e.jsx(ee,{children:e.jsxs(y,{direction:"row",divider:e.jsx(ce,{orientation:"vertical",flexItem:!0,sx:{borderStyle:"dashed"}}),sx:{py:2},children:[e.jsx(R,{title:"Total",total:o.length,percent:100,price:Q(o,"totalAmount"),icon:"list",color:a.palette.info.main,selectedFilter:t.status,onClick:()=>F("all")}),e.jsx(R,{title:"Warning",total:v("warning"),percent:N("warning"),price:V("warning"),icon:"danger",color:a.palette.warning.main,selectedFilter:t.status,onClick:()=>F("warning")}),e.jsx(R,{title:"Alarm",total:v("alarm"),percent:N("alarm"),price:V("alarm"),icon:"alarm",color:a.palette.error.main,selectedFilter:t.status,onClick:()=>F("alarm")}),e.jsx(R,{title:"Archived",total:v("archived"),percent:N("archived"),price:V("archived"),icon:"check_read",color:a.palette.text.secondary,selectedFilter:t.status,onClick:()=>F("archived")}),e.jsx(R,{title:"Acknowledged",total:v("acknowledged"),percent:N("acknowledged"),price:V("acknowledged"),icon:"checkmark_circle",color:a.palette.success.main,selectedFilter:t.status,onClick:()=>F("acknowledged")})]})})}),e.jsxs(Z,{children:[e.jsx(qe,{value:t.status,onChange:be,sx:{px:2.5,boxShadow:`inset 0 -2px 0 0 ${M(a.palette.grey[500],.08)}`,backgroundColor:a.palette.primary.main},children:xe.map(s=>e.jsx(Ge,{value:s.value,label:s.label,iconPosition:"end",icon:e.jsx(ie,{variant:(s.value==="all"||s.value===t.status)&&"filled"||"soft",color:s.color,children:s.count}),sx:{color:t.status===s.value?a.palette.primary.contrastText:"white","&.Mui-selected":{color:a.palette.primary.contrastText},"&:hover":{backgroundColor:M(a.palette.grey[500],.1)}}},s.value))}),e.jsx(ue,{filters:t,onFilters:E,dateError:k,serviceOptions:Ue.map(s=>s.name),deviceOption:Je}),D&&e.jsx(he,{filters:t,onFilters:E,onResetFilters:we,results:C.length,sx:{p:2.5,pt:0}}),e.jsxs(Ke,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Ye,{dense:n.dense,numSelected:n.selected.length,rowCount:o.length,onSelectAllRows:s=>n.onSelectAllRows(s,o.map(p=>p.id)),action:e.jsxs(y,{direction:"row",children:[e.jsx(W,{title:"Sent",children:e.jsx(O,{color:"primary",children:e.jsx(f,{icon:"iconamoon:send-fill"})})}),e.jsx(W,{title:"Download",children:e.jsx(O,{color:"primary",children:e.jsx(f,{icon:"eva:download-outline"})})}),e.jsx(W,{title:"Print",children:e.jsx(O,{color:"primary",children:e.jsx(f,{icon:"solar:printer-minimalistic-bold"})})}),e.jsx(W,{title:"Delete",children:e.jsx(O,{color:"primary",onClick:h.onTrue,children:e.jsx(f,{icon:"solar:trash-bin-trash-bold"})})})]})}),e.jsx(ee,{children:e.jsxs(Xe,{size:n.dense?"small":"medium",sx:{minWidth:800},children:[e.jsx(Ze,{order:n.order,orderBy:n.orderBy,headLabel:ca,rowCount:o.length,onSort:n.onSort}),e.jsxs(ea,{children:[C.slice(n.page*n.rowsPerPage,n.page*n.rowsPerPage+n.rowsPerPage).map(s=>e.jsx(pe,{row:s,selected:n.selected.includes(s.sensor_alarm_id),onSelectRow:()=>n.onSelectRow(s.sensor_alarm_id),onViewRow:()=>fe(s.sensor_alarm_id),onEditRow:()=>je(s.sensor_alarm_id),onDeleteRow:()=>me(s.sensor_alarm_id)},s.id)),e.jsx(aa,{height:S,emptyRows:ta(n.page,n.rowsPerPage,o.length)}),e.jsx(na,{notFound:ge})]})]})})]}),e.jsx(sa,{count:C.length,page:n.page,rowsPerPage:n.rowsPerPage,onPageChange:n.onChangePage,onRowsPerPageChange:n.onChangeRowsPerPage,dense:n.dense,onChangeDense:n.onChangeDense})]})]}),e.jsx(de,{open:h.value,onClose:h.onFalse,title:"Acknowledge",content:e.jsx(e.Fragment,{children:"Are you sure want to acknowledge the alarm?"}),action:e.jsx(G,{variant:"contained",color:"primary",onClick:()=>{ye(),h.onFalse()},children:"Acknowledge"})})]})}function ua({inputData:a,comparator:i,filters:g,dateError:x}){const{name:n,status:h,service:j,device:o,startDate:b,endDate:m}=g,r=a.map((t,u)=>[t,u]);if(r.sort((t,u)=>{const w=i(t[0],u[0]);return w!==0?w:t[1]-u[1]}),a=r.map(t=>t[0]),n&&(o.device_name,a=a.filter(t=>t.alarm_message.toLowerCase().indexOf(n.toLowerCase())!==-1||t.device.device_name.toLowerCase().indexOf(n.toLowerCase())!==-1)),h!=="all"&&(h==="acknowledged"?a=a.filter(t=>t.acknowledged===1):a=a.filter(t=>t.status===h)),j.length&&console.log("service--->",j),o.length){console.log("device--->",o),console.log("inputData--->",a);let t=[],u;o.map(w=>{switch(w){case"AQI05":u=3;break;case"AQI02":u=5;break;case"AQI02":u=4;break}t.push(u)}),console.log("deviceArr--->",t),a=a.filter(w=>t.includes(w.device.device_type_id))}return x||b&&m&&(a=a.filter(t=>z(t.createdAt)>=z(b)&&z(t.createdAt)<=z(m))),a}function ba(){return e.jsxs(e.Fragment,{children:[e.jsx(ra,{children:e.jsx("title",{children:" Dashboard: Alarms"})}),e.jsx(da,{})]})}export{ba as default};
