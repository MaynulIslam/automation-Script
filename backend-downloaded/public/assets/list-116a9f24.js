import{q as n,s as De,r as d,j as e,S as V,bV as ye,bW as _e,bX as we,bZ as Ce,M as C,bb as pe,bU as rs,I as ls,w as D,y as qe,B as F,_ as Te,du as Y,ao as U,P as as,ah as is,ai as os,d as ge,dv as te,i as Ie,o as ke,dw as cs,aH as Pe,aI as Re,bA as Ee,F as Ne,A as ae,R as I,dc as ie,bJ as X,aG as Ae,bY as Le,L as he,g as Fe,h as E,aS as ds,dx as us,dy as ms,aA as ps,az as H,aB as N,aC as hs,aD as xs,aE as gs,dz as bs,dA as fs,cp as js,co as vs,e as ys,aN as _s,Q as ws,f as ee,bT as Cs,U as Ts,bF as As,dB as Ss,dC as Ds,dD as qs,X as Is,c$ as Se,bv as se,D as ks,aq as Ps,ca as Rs,m as oe,ar as Es,as as Ns,at as Ls,au as Fs,d6 as Ms,bM as Os,bN as $s,av as zs,bO as Bs,bP as ue,cj as Hs,dE as Us,dF as Vs,dG as Ws,bc as Me,K as Zs,cu as Gs,W as Qs}from"./index-b5422eae.js";import"./_baseToString-ddfaf6f7.js";import"./color-picker-e9a3d8c9.js";import"./lightbox-bbab6fe8.js";import"./carousel-arrow-index-2fd86e94.js";import"./markdown-6bcee500.js";import"./ResizeObserver.es-eef8c2d8.js";n.object;n.string;n.number;n.object;n.object;n.bool,n.array;n.func,n.string,n.array;n.func,n.bool,n.func,n.string,n.array;n.bool,n.func,n.func,n.bool,n.object,n.func,n.array,n.func,n.array,n.array,n.arrayOf(n.string);n.func,n.oneOf(["min","max"]),n.arrayOf(n.number);n.bool,n.object,n.func,n.number,n.func;n.node,n.string,n.object;function Oe({filters:s,onFilters:t,deviceTypeOptions:p,publishOptions:l,levelListOptions:g}){const a=De(),x=d.useCallback(c=>{t("searchFilter",c.target.value)},[t]),i=d.useCallback(c=>{t("deviceType",typeof c.target.value=="string"?c.target.value.split(","):c.target.value)},[t]),b=d.useCallback(c=>{t("levelTypeList",typeof c.target.value=="string"?c.target.value.split(","):c.target.value)},[t]);return d.useCallback(c=>{t("publish",typeof c.target.value=="string"?c.target.value.split(","):c.target.value)},[t]),e.jsxs(e.Fragment,{children:[e.jsxs(V,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsxs(ye,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(_e,{children:"Device type"}),e.jsx(we,{multiple:!0,value:s.deviceType,onChange:i,input:e.jsx(Ce,{label:"Device type"}),renderValue:c=>c.map(f=>f).join(", "),sx:{textTransform:"capitalize"},children:p.map(c=>e.jsxs(C,{value:c.value,children:[e.jsx(pe,{disableRipple:!0,color:"default",size:"small",checked:s.deviceType.includes(c.value)}),e.jsx("span",{dangerouslySetInnerHTML:{__html:c.label}})]},c.value))})]}),e.jsxs(ye,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(_e,{children:"Level Type"}),e.jsx(we,{multiple:!0,value:s.levelTypeList,onChange:b,input:e.jsx(Ce,{label:"Level type"}),renderValue:c=>c.map(f=>f).join(", "),sx:{textTransform:"capitalize"},children:g.map(c=>e.jsxs(C,{value:c.id,children:[e.jsx(pe,{disableRipple:!0,color:"default",size:"small",checked:s.levelTypeList.includes(c.id)}),e.jsx("span",{dangerouslySetInnerHTML:{__html:c.field_value}})]},c.id))})]}),e.jsx(V,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:e.jsx(rs,{fullWidth:!0,value:s.name,onChange:x,placeholder:"Search...",InputProps:{startAdornment:e.jsx(ls,{position:"start",children:e.jsx(D,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}})})]}),e.jsxs(qe,{open:a.open,onClose:a.onClose,arrow:"right-top",sx:{width:140},children:[e.jsxs(C,{onClick:()=>{a.onClose()},children:[e.jsx(D,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(C,{onClick:()=>{a.onClose()},children:[e.jsx(D,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(C,{onClick:()=>{a.onClose()},children:[e.jsx(D,{icon:"solar:export-bold"}),"Export"]})]})]})}Oe.propTypes={filters:n.object,onFilters:n.func,publishOptions:n.array,deviceTypeOptions:n.array};function $e({filters:s,onFilters:t,onResetFilters:p,results:l,...g}){const a=i=>{const b=s.deviceType.filter(c=>c!==i);t("deviceType",b)},x=()=>{t("status","all")};return e.jsxs(V,{spacing:1.5,...g,children:[e.jsxs(F,{sx:{typography:"body2"},children:[e.jsx("strong",{children:l}),e.jsx(F,{component:"span",sx:{color:"text.secondary",ml:.25},children:"results found"})]}),e.jsxs(V,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[!!s.deviceType.length&&e.jsx(xe,{label:"Device Type:",children:s.deviceType.map(i=>e.jsx(Te,{label:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(i)}}),size:"small",onDelete:()=>a(i)},i))}),s.status&&s.status!=="all"&&e.jsx(xe,{label:"Status:",children:e.jsx(Te,{size:"small",label:s==null?void 0:s.status.toUpperCase(),onDelete:x})}),e.jsx(U,{color:"error",onClick:p,startIcon:e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]})]})}$e.propTypes={filters:n.object,onFilters:n.func,onResetFilters:n.func,results:n.number};function xe({label:s,children:t,sx:p,...l}){return e.jsxs(V,{component:as,variant:"outlined",spacing:1,direction:"row",sx:{p:1,borderRadius:1,overflow:"hidden",borderStyle:"dashed",...p},...l,children:[e.jsx(F,{component:"span",sx:{typography:"subtitle2"},children:s}),e.jsx(V,{spacing:1,direction:"row",flexWrap:"wrap",children:t})]})}xe.propTypes={children:n.node,label:n.string,sx:n.object};var be={},Js=os;Object.defineProperty(be,"__esModule",{value:!0});var ze=be.default=void 0,Ys=Js(is()),Xs=e,Ks=(0,Ys.default)((0,Xs.jsx)("path",{d:"M15.9 5c-.17 0-.32.09-.41.23l-.07.15-5.18 11.65c-.16.29-.26.61-.26.96 0 1.11.9 2.01 2.01 2.01.96 0 1.77-.68 1.96-1.59l.01-.03L16.4 5.5c0-.28-.22-.5-.5-.5zM1 9l2 2c2.88-2.88 6.79-4.08 10.53-3.62l1.19-2.68C9.89 3.84 4.74 5.27 1 9zm20 2 2-2c-1.64-1.64-3.55-2.82-5.59-3.57l-.53 2.82c1.5.62 2.9 1.53 4.12 2.75zm-4 4 2-2c-.8-.8-1.7-1.42-2.66-1.89l-.55 2.92c.42.27.83.59 1.21.97zM5 13l2 2c1.13-1.13 2.56-1.79 4.03-2l1.28-2.88c-2.63-.08-5.3.87-7.31 2.88z"}),"NetworkCheck");ze=be.default=Ks;const en=Fe().shape({deviceName:E().required("Device Name is required"),ipAddress:E().required("IP Address is required").matches(/^(\d{1,3}\.){3}\d{1,3}$/,"Invalid IP Address"),macAddress:E().required("MAC Address is required").matches(/^(?!00:00:00:00:00:00)([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,"Invalid MAC Address"),deviceType:E().required("Device Type is required"),unit_number:E().required("Unit is required"),username:E().nullable(),password:E().nullable()}),sn=async(s,t,p)=>{var l,g;try{const a=await ms(s,t,p);return console.info("result",a),a.status?a.connection_result:{success:!1,message:((l=a.connection_result)==null?void 0:l.message)||"Connection failed",error:((g=a.connection_result)==null?void 0:g.error)||"Unknown error"}}catch(a){return{success:!1,message:"Error connecting to device",error:a.message}}},nn=s=>{var p;const t=X.find(l=>l.value===s||l.label===s);return t?t.value:((p=X[0])==null?void 0:p.value)||""};function Be({device:s,open:t,onClose:p,levelList:l,isManual:g=!1}){const{enqueueSnackbar:a}=ge(),{deviceTypes:x}=te(),[i,b]=d.useState(null),[c,f]=d.useState(""),v=l.length>0?l[0].id:"",P=d.useMemo(()=>({deviceName:(s==null?void 0:s.deviceName)||"",ipAddress:(s==null?void 0:s.ipAddress)||"",macAddress:(s==null?void 0:s.macAddress)||"",deviceType:(s==null?void 0:s.deviceType)||"",username:(s==null?void 0:s.username)||"",password:(s==null?void 0:s.password)||"",unit_number:(s==null?void 0:s.unit_number)||"",level:(s==null?void 0:s.level)||v,equipment_number_1:(s==null?void 0:s.equipment_number_1)||"",equipment_number_2:(s==null?void 0:s.equipment_number_2)||""}),[s,v]),$=Ie({resolver:ke(en),defaultValues:P}),{reset:T,handleSubmit:k,watch:A,setValue:m,getValues:y,formState:{isSubmitting:w}}=$,q=A("deviceType"),ce=A("unit_number"),K=A("level"),re=A("ipAddress");d.useEffect(()=>{t&&(f(""),b(null))},[t]);const Z=async()=>{const u=y("ipAddress"),_=y("username"),W=y("password");if(!u||!u.match(/^(\d{1,3}\.){3}\d{1,3}$/)){a("Please enter a valid IP address first",{variant:"error"});return}b("loading"),f("");try{const j=await sn(u,_,W);j.success?(b("success"),f(j.message),a(j.message,{variant:"success"})):(b("error"),f(j.message),a(j.message,{variant:"error"}))}catch(j){console.error("Connection test error:",j),b("error"),f("Failed to connect to device"),a("Failed to connect to device",{variant:"error"})}},G=k(async u=>{try{let _;x.length?_=x.find(j=>j.type_code===u.deviceType):_=te().find(j=>j.type_code===u.deviceType);let W={deviceName:u.deviceName,macId:u.macAddress,ipAddress:u.ipAddress,device_type_id:_.id,equipment_number_1:u.equipment_number_1,equipment_number_2:u.equipment_number_2,custom_field_id:u.level,unit_number:u.unit_number,username:u.username,password:u.password,manual_add:g};try{const j=await cs(W);j.status?(a(j.response.message.message||"Added device.",{variant:"success"}),T(),b(null),f(""),p()):a(j.response.message.message||"Error occurred while adding device.",{variant:"error"})}catch(j){console.error("error",j),a(j.response.message||"Error occurred while adding device.",{variant:"error"})}}catch(_){console.error(_)}});d.useEffect(()=>{let u=l.find(W=>W.id===K);const _=`${q||"DEVICE_TYPE"}-${(u==null?void 0:u.field_value)||"0000L"}-${ce||"0000"}`;m("equipment_number_1",_)},[q,K,ce,m,l]),d.useEffect(()=>{s?(console.log("Device received in AddDeviceManualForm:",s),T({deviceName:s.deviceName||"",ipAddress:s.ipAddress||"",macAddress:s.macAddress||"",deviceType:nn(s.deviceType),username:s.username||"",password:s.password||"",unit_number:s.unit_number||"",level:s.level||v,equipment_number_1:s.equipment_number_1||"",equipment_number_2:s.equipment_number_2||""}),console.log("Form values after reset:",y())):T(P)},[s,T,y,v,P]);const Q=()=>{const u=re&&re.match(/^(\d{1,3}\.){3}\d{1,3}$/);let _=e.jsx(ze,{});return i==="loading"&&(_=e.jsx(Ae,{size:24})),i==="success"&&(_=e.jsx(ds,{color:"success"})),i==="error"&&(_=e.jsx(us,{color:"error"})),e.jsx(he,{onClick:Z,disabled:!u||i==="loading",color:i==="success"?"success":i==="error"?"error":"primary",loading:i==="loading",variant:"contained",size:"small",startIcon:i!=="loading"?_:null,sx:{ml:1},children:"Test Connection"})},M=()=>{if(!q||!x.length)return!1;const u=x.find(_=>_.type_code===q);return u&&(u.id===4||u.id===5)};return e.jsxs(Pe,{fullWidth:!0,maxWidth:!1,PaperProps:{sx:{maxWidth:720}},open:t,onClose:p,children:[e.jsx(Re,{children:"Add Device"}),e.jsx(Ee,{children:e.jsx(F,{children:e.jsxs(Ne,{methods:$,onSubmit:G,children:[e.jsx(ae,{variant:"outlined",severity:"info",sx:{mb:3},children:"Add device"}),e.jsxs(F,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(I,{name:"deviceName",label:"Device Name"}),e.jsx(I,{name:"ipAddress",label:"IP Address"}),e.jsx(I,{name:"macAddress",label:"MAC Address"}),e.jsx(ie,{name:"deviceType",label:"Device Type",children:X.map(u=>e.jsx(C,{value:u.value,children:e.jsx("span",{dangerouslySetInnerHTML:{__html:u.label}})},u.value))}),e.jsx(ie,{name:"level",label:"Level",children:l.map(u=>e.jsx(C,{value:u.id,children:e.jsx("span",{dangerouslySetInnerHTML:{__html:u.field_value}})},u.id))}),e.jsx(I,{name:"unit_number",label:"Unit"}),e.jsx(I,{name:"equipment_number_1",label:"Equipment Number 1"}),e.jsx(I,{name:"equipment_number_2",label:"Equipment Number 2"}),M()&&e.jsxs(e.Fragment,{children:[e.jsx(I,{name:"username",label:"Username"}),e.jsx(I,{name:"password",label:"Password",type:"password",autoComplete:"new-password"})]})]}),M()&&e.jsxs(F,{sx:{mt:3,mb:2},children:[i&&(i==="loading"?e.jsx(ae,{severity:"info",sx:{mb:2},icon:e.jsx(Ae,{size:20}),children:"Testing connection to device..."}):e.jsx(ae,{severity:i==="success"?"success":"error",sx:{mb:2},children:c})),e.jsx(V,{direction:"row",justifyContent:"flex-end",children:Q()})]}),e.jsxs(Le,{children:[e.jsx(U,{onClick:p,children:"Cancel"}),e.jsx(he,{type:"submit",variant:"contained",color:"primary",loading:w,disabled:M()&&(i==="error"||i===null),children:"Save"})]})]})})})]})}Be.propTypes={device:n.object,open:n.bool,onClose:n.func,levelList:n.array.isRequired,isManual:n.bool};const tn={width:24,height:24,body:'<g fill="currentColor"><path d="M3 6.386c0-.484.345-.877.771-.877h2.665c.529-.016.996-.399 1.176-.965l.03-.1l.115-.391c.07-.24.131-.45.217-.637c.338-.739.964-1.252 1.687-1.383c.184-.033.378-.033.6-.033h3.478c.223 0 .417 0 .6.033c.723.131 1.35.644 1.687 1.383c.086.187.147.396.218.637l.114.391l.03.1c.18.566.74.95 1.27.965h2.57c.427 0 .772.393.772.877s-.345.877-.771.877H3.77c-.425 0-.77-.393-.77-.877Z"/><path fill-rule="evenodd" d="M11.596 22h.808c2.783 0 4.174 0 5.08-.886c.904-.886.996-2.339 1.181-5.245l.267-4.188c.1-1.577.15-2.366-.303-2.865c-.454-.5-1.22-.5-2.753-.5H8.124c-1.533 0-2.3 0-2.753.5c-.454.5-.404 1.288-.303 2.865l.267 4.188c.185 2.906.277 4.36 1.182 5.245c.905.886 2.296.886 5.079.886Zm-1.35-9.811c-.04-.434-.408-.75-.82-.707c-.413.043-.713.43-.672.864l.5 5.263c.04.434.408.75.82.707c.413-.043.713-.43.672-.864l-.5-5.263Zm4.329-.707c.412.043.713.43.671.864l-.5 5.263c-.04.434-.409.75-.82.707c-.413-.043-.713-.43-.672-.864l.5-5.263c.04-.434.409-.75.82-.707Z" clip-rule="evenodd"/></g>'},rn=tn,ln={width:24,height:24,body:'<g fill="currentColor"><path d="M9.75 12a2.25 2.25 0 1 1 4.5 0a2.25 2.25 0 0 1-4.5 0Z"/><path fill-rule="evenodd" d="M2 12c0 1.64.425 2.191 1.275 3.296C4.972 17.5 7.818 20 12 20c4.182 0 7.028-2.5 8.725-4.704C21.575 14.192 22 13.639 22 12c0-1.64-.425-2.191-1.275-3.296C19.028 6.5 16.182 4 12 4C7.818 4 4.972 6.5 3.275 8.704C2.425 9.81 2 10.361 2 12Zm10-3.75a3.75 3.75 0 1 0 0 7.5a3.75 3.75 0 0 0 0-7.5Z" clip-rule="evenodd"/></g>'},an=ln,on={width:24,height:24,body:'<g fill="none"><path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"/><path fill="currentColor" d="M16.035 3.015a3 3 0 0 1 4.099-.135l.144.135l.707.707a3 3 0 0 1 .135 4.098l-.135.144L9.773 19.177a1.5 1.5 0 0 1-.562.354l-.162.047l-4.454 1.028a1.001 1.001 0 0 1-1.22-1.088l.02-.113l1.027-4.455a1.5 1.5 0 0 1 .29-.598l.111-.125L16.035 3.015Zm-.707 3.535l-8.99 8.99l-.636 2.758l2.758-.637l8.99-8.99l-2.122-2.12Zm3.536-2.121a1 1 0 0 0-1.32-.083l-.094.083l-.708.707l2.122 2.121l.707-.707a1 1 0 0 0 .083-1.32l-.083-.094l-.707-.707Z"/></g>'},cn=on;function He({row:s,selected:t,onSelectRow:p,onAddRow:l,onEditRow:g,onViewRow:a,onDeleteRow:x}){const{id:i,dbId:b,is_added:c,deviceName:f,ipAddress:v,macId:P,manufacturer:$,moduleName:T,status:k,online:A,equipment_number_1:m,equipment_number_2:y}=s,w=De();return e.jsxs(e.Fragment,{children:[e.jsxs(ps,{hover:!0,selected:t,children:[e.jsx(H,{padding:"checkbox",children:e.jsx(pe,{checked:t,onClick:p,color:"default"})}),e.jsxs(H,{align:"center",children:[(s.moduleName==="AQI02"||s.moduleName==="AQI05")&&e.jsx(N,{title:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(T)}}),children:A?e.jsx("img",{src:"/assets/images/vaqs.svg",width:50,height:50,alt:"vaqs"}):e.jsx("img",{src:"/assets/images/vaqsoff.svg",width:50,height:50,alt:"vaqs"})}),s.moduleName==="AQI04"&&e.jsx(N,{title:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(T)}}),children:A?e.jsx("img",{src:"/assets/images/zaqs.svg",width:50,height:50,alt:"zaqs"}):e.jsx("img",{src:"/assets/images/zaqsoff.svg",width:50,height:50,alt:"zaqs"})}),s.moduleName==="PSW01"&&e.jsx(N,{title:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(T)}}),children:e.jsx("img",{src:"/assets/images/plexus.png",width:50,height:50,alt:"plexus"})}),(s.moduleName==="MRQ05"||s.moduleName==="LDI01")&&e.jsx(N,{title:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(T)}}),children:A?e.jsx("img",{src:"/assets/images/marquee.png",width:50,height:50,alt:"marquee"}):e.jsx("img",{src:"/assets/images/marqueeoff.png",width:50,height:50,alt:"marquee"})}),s.moduleName==="MOD05"&&e.jsx(N,{title:e.jsx("span",{dangerouslySetInnerHTML:{__html:Y(T)}}),children:A?e.jsx("img",{src:"/assets/images/modudrivenew.png",width:40,height:50,alt:"modudrive"}):e.jsx("img",{src:"/assets/images/modudrive-offline.png",width:40,height:50,alt:"modudrive"})})]}),e.jsx(H,{children:e.jsx(hs,{disableTypography:!0,primary:e.jsx(xs,{noWrap:!0,color:"inherit",variant:"subtitle2",href:`http://${v}/`,target:"_blank",rel:"noopener noreferrer",sx:{cursor:"context-menu",display:"flex",alignItems:"center"},children:f}),secondary:e.jsx(F,{component:"span",sx:{typography:"body2",color:"text.disabled"},children:v})})}),e.jsx(H,{align:"center",children:e.jsx(gs,{variant:"soft",color:A&&"success"||!A&&"error",children:A?"Online":"Offline"})}),e.jsx(H,{children:m}),e.jsx(H,{children:y}),e.jsx(H,{children:P}),e.jsx(H,{align:"right",children:e.jsxs(F,{display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(N,{title:"View",arrow:!0,children:e.jsx(C,{onClick:()=>{a(),w.onClose()},children:e.jsx(D,{icon:an})})}),k&&e.jsx(N,{title:"Edit",arrow:!0,children:e.jsx(C,{onClick:()=>{g(s),w.onClose()},children:e.jsx(D,{icon:cn})})}),!k&&e.jsx(N,{title:"Add",arrow:!0,children:e.jsx(C,{onClick:()=>{l(),w.onClose()},children:e.jsx(D,{icon:bs,width:24,sx:{color:"info.main"}})})}),k&&e.jsx(N,{title:"Remove",arrow:!0,children:e.jsx(C,{onClick:()=>{x(),w.onClose()},children:e.jsx(D,{icon:rn,width:24,sx:{color:"error.main"}})})})]})})]}),e.jsxs(qe,{open:w.open,onClose:w.onClose,arrow:"right-top",sx:{width:140},children:[e.jsxs(C,{onClick:()=>{a(),w.onClose()},children:[e.jsx(D,{icon:"solar:eye-bold"}),"View"]}),!k&&e.jsxs(C,{onClick:()=>{l(),w.onClose()},children:[e.jsx(D,{icon:"mingcute:add-line"}),"Add"]}),k&&e.jsxs(C,{onClick:()=>{x(),w.onClose()},children:[e.jsx(D,{icon:"solar:trash-bin-trash-bold"}),"Remove"]})]})]})}He.propTypes={onAddRow:n.func,onEditRow:n.func,onSelectRow:n.func,onViewRow:n.func,row:n.object,selected:n.bool};const dn=Fe().shape({deviceName:E().required("Device Name is required"),ipAddress:E().required("IP Address is required").matches(/^(\d{1,3}\.){3}\d{1,3}$/,"Invalid IP Address"),macAddress:E().required("MAC Address is required").matches(/^(?!00:00:00:00:00:00)([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,"Invalid MAC Address"),deviceType:E().required("Device Type is required"),unit_number:E().required("Unit is required")});function Ue({device:s,open:t,onClose:p,levelList:l}){const{enqueueSnackbar:g}=ge(),{deviceTypes:a}=te();d.useState(null);const x=d.useMemo(()=>({deviceName:(s==null?void 0:s.deviceName)||"",ipAddress:(s==null?void 0:s.ipAddress)||"",macAddress:(s==null?void 0:s.macAddress)||"",deviceType:(s==null?void 0:s.deviceType)||""}),[s]),i=Ie({resolver:ke(dn),defaultValues:x}),{reset:b,handleSubmit:c,watch:f,setValue:v,formState:{isSubmitting:P}}=i,$=f("deviceType"),T=f("unit_number"),k=f("level");d.useEffect(()=>{if(s){console.log("device",s),v("deviceName",s.deviceName),v("ipAddress",s.ipAddress),v("macAddress",s.macId),v("unit_number",s.unit_number),v("equipment_number_2",s.equipment_number_2);let m=X.filter(y=>y.value===s.moduleName)[0];v("deviceType",m.value),v("level",s.custom_field_id)}},[s]);const A=c(async m=>{try{console.log("data---->",m),console.log("level---->",k);let y;a.length?y=a.find(q=>q.type_code===m.deviceType):y=te().find(q=>q.type_code===m.deviceType);let w={deviceName:m.deviceName,macId:m.macAddress,ipAddress:m.ipAddress,device_type_id:y.id,equipment_number_1:m.equipment_number_1,equipment_number_2:m.equipment_number_2,custom_field_id:m.level,unit_number:m.unit_number};try{await fs(s.dbId,w),g("Updated device.",{variant:"success"}),b(),p()}catch(q){console.error("error",q),g("Error occurred while updating device.",{variant:"error"})}}catch(y){console.error(y)}});return d.useEffect(()=>{let m=l.find(w=>w.id===k);const y=`${$||"DEVICE_TYPE"}-${(m==null?void 0:m.field_value)||"0000L"}-${T||"0000"}`;v("equipment_number_1",y)},[$,k,T,v]),e.jsxs(Pe,{fullWidth:!0,maxWidth:!1,PaperProps:{sx:{maxWidth:720}},open:t,onClose:p,onSubmit:A,children:[e.jsx(Re,{children:"Edit Device"}),e.jsx(Ee,{children:e.jsx(F,{children:e.jsxs(Ne,{methods:i,children:[e.jsx(ae,{variant:"outlined",severity:"info",sx:{mb:3},children:"Edit device details"}),e.jsxs(F,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(I,{name:"deviceName",label:"Device Name"}),e.jsx(I,{name:"ipAddress",label:"IP Address"}),e.jsx(I,{name:"macAddress",label:"MAC Address"}),e.jsx(ie,{name:"deviceType",label:"Device Type",children:X.map(m=>e.jsx(C,{value:m.value,children:e.jsx("span",{dangerouslySetInnerHTML:{__html:m.label}})},m.value))}),e.jsx(ie,{name:"level",label:"Level",children:l.map(m=>e.jsx(C,{value:m.id,children:e.jsx("span",{dangerouslySetInnerHTML:{__html:m.field_value}})},m.id))}),e.jsx(I,{name:"unit_number",label:"Unit"}),e.jsx(I,{name:"equipment_number_1",label:"Equipment Number 1"}),e.jsx(I,{name:"equipment_number_2",label:"Equipment Number 2"})]}),e.jsxs(Le,{children:[e.jsx(U,{onClick:p,children:"Cancel"}),e.jsx(he,{type:"submit",variant:"contained",loading:P,children:"Save"})]})]})})})]})}Ue.propTypes={device:n.object,open:n.bool,onClose:n.func,onSubmit:n.func};class un{constructor(){this.client=null,this.connected=!1,this.initialize()}initialize(){this.client=js.connect(`ws://${vs}:8083/mqtt`),this.client.on("connect",()=>{console.log("MQTT Publisher connected"),this.connected=!0}),this.client.on("error",t=>{console.error("MQTT Publisher error:",t),this.connected=!1}),this.client.on("close",()=>{console.log("MQTT Publisher disconnected"),this.connected=!1})}publish(t,p){return new Promise((l,g)=>{if(!this.client||!this.connected){g(new Error("MQTT Publisher not connected"));return}try{const a=typeof p=="string"?p:JSON.stringify(p);this.client.publish(t,a,x=>{x?(console.error("MQTT publish error:",x),g(x)):(console.log("Published to:",t),l(!0))})}catch(a){console.error("Error publishing message:",a),g(a)}})}disconnect(){this.client&&(this.client.end(),this.connected=!1)}}const mn=new un,pn=[{id:"device_list_product",label:"Product",width:64},{id:"device_list_name",label:"Device Name"},{id:"device_list_status",label:"Comm. Status",width:75},{id:"device_list_equipment_number_1",label:"Equipment #1",width:220},{id:"device_list_equipment_number_2",label:"Equipment #2",width:120},{id:"device_list_mac_address",label:"MAC Address",width:160},{id:"device_list_actions",width:88}],hn=[{value:"published",label:"Published"},{value:"draft",label:"Draft"}],me={searchFilter:"",deviceTypeOptions:[],deviceType:[],levelTypeList:[]};function xn(){ys();const{enqueueSnackbar:s}=ge(),t=_s(),p=ws(),[l,g]=d.useState([]),[a,x]=d.useState(me),[i,b]=d.useState(null),[c,f]=d.useState(!0),[v,P]=d.useState(!0),[$,T]=d.useState(null),[k,A]=d.useState(null),[m,y]=d.useState([]),[w,q]=d.useState(null),[ce,K]=d.useState(!1),re=d.useRef(null);te();const Z=ee(),G=ee(),Q=ee(),M=ee(),u=ee(),_=t.dense?60:80,W=!Cs(me,a),j=v,z=Ts(["maestrolink/system/discoverable","maestrolink/marq/status"]),[Ve,de]=d.useState(null),fe=r=>{b(o=>{const h=JSON.parse(r);return h!==o?(f(!1),P(!1),g(Object.values(h)),h):o})};d.useEffect(()=>(z&&(z.connected?z.on("message",(r,o)=>{r==="maestrolink/system/discoverable"&&fe(o)}):z.on("connect",()=>{z.on("message",(r,o)=>{r==="maestrolink/system/discoverable"&&fe(o)})})),()=>{z&&z.end()}),[z]);const We=async()=>{try{const r=await Us();y(r)}catch(r){console.error("error",r)}},je=async()=>{let r=await Vs();return await new Promise(o=>setTimeout(o,200)),await mn.publish("duetto/system/discoverable",JSON.stringify(r)),r},J=d.useCallback(async()=>{f(!0),P(!1);try{const r=await je();!r||Object.keys(r).length===0?setTimeout(async()=>{const o=await je();(!o||Object.keys(o).length===0)&&P(!0),f(!1)},2e3):setTimeout(()=>{f(!1)},500)}catch(r){console.error("Error fetching devices:",r),f(!1),P(!0)}},[]);d.useEffect(()=>{We(),J()},[J]);const L=gn({inputData:l,comparator:As(t.order,t.orderBy),filters:a}),le=L.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),ve=d.useCallback((r,o)=>{t.onResetPage(),x(h=>({...h,[r]:o}))},[t]),Ze=d.useCallback(async()=>{try{let r=await Ss($.dbId);s(r.message,{variant:"success"}),T(null)}catch(r){console.error("error",r),s("Error occurred while deleting device.",{variant:"error"}),T(null)}},[le.length,t,l]),Ge=d.useCallback(async r=>{T(r),G.onTrue()}),Qe=d.useCallback(async r=>{try{const o={deviceName:r.deviceName||r.ipAddress,ipAddress:r.ipAddress,macAddress:r.macId,deviceType:r.moduleName};de(o),M.onTrue()}catch(o){console.error("Error preparing device data:",o),s("Error occurred while preparing device data.",{variant:"error"})}},[s,M]),Je=d.useCallback(async r=>{try{const o=l.filter(h=>t.selected.includes(h.id));if(t.selected.length){let h=[];o.forEach(R=>{h.push(R.dbId)}),Ds(h)}t.onUpdatePageDeleteRows({totalRows:l.length,totalRowsInPage:le.length,totalRowsFiltered:L.length})}catch(o){console.log("error",o)}},[L.length,le.length,t,l]),Ye=d.useCallback(async()=>{try{const r=l.filter(o=>t.selected.includes(o.id));if(r.length>0){const o=r.map(R=>({deviceName:R.deviceName||R.ipAddress,ipAddress:R.ipAddress,macAddress:R.macId,deviceType:R.moduleName})),h=await qs(o);h.success?(s(`Successfully added ${h.imported_count} devices`,{variant:"success"}),t.onSelectAllRows(!1,[]),await J()):s("Failed to add devices",{variant:"error"})}}catch(r){console.error("Error adding devices:",r),s("Error occurred while adding devices",{variant:"error"})}},[l,t,s,J]),Xe=d.useCallback(r=>{A(r),u.onTrue()},[L.length,le.length,t,l]),Ke=d.useCallback(r=>{const o=`http://${r.ipAddress}/`;window.open(o,"_blank")},[]),es=d.useCallback(()=>{x(me)},[]),ss=()=>{try{const r=["Device Name","IP Address","MAC ID","Status","Equipment #1","Equipment #2","Module Name"],o=L.map(O=>[`"${(O.deviceName||"").replace(/"/g,'""')}"`,`"${(O.ipAddress||"").replace(/"/g,'""')}"`,`"${(O.macId||"").replace(/"/g,'""')}"`,`"${O.online?"Online":"Offline"}"`,`"${(O.equipment_number_1||"").replace(/"/g,'""')}"`,`"${(O.equipment_number_2||"").replace(/"/g,'""')}"`,`"${(O.moduleName||"").replace(/"/g,'""')}"`]),h=[r.join(","),...o.map(O=>O.join(","))].join(`
`),R=new Blob([h],{type:"text/csv"}),B=window.URL.createObjectURL(R),S=document.createElement("a");S.href=B,S.download=`devices_export_${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(B),s("Devices exported to CSV successfully",{variant:"success"}),q(null)}catch(r){console.error("Error exporting CSV:",r),s("Failed to export devices to CSV",{variant:"error"})}},ns=()=>{try{const r={export_date:new Date().toISOString(),total_devices:L.length,devices:L.map(S=>({device_name:S.deviceName,ip_address:S.ipAddress,mac_id:S.macId,status:S.online?"Online":"Offline",equipment_number_1:S.equipment_number_1,equipment_number_2:S.equipment_number_2,module_name:S.moduleName,manufacturer:S.manufacturer,is_added:S.is_added,db_id:S.dbId}))},o=JSON.stringify(r,null,2),h=new Blob([o],{type:"application/json"}),R=window.URL.createObjectURL(h),B=document.createElement("a");B.href=R,B.download=`devices_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(B),B.click(),document.body.removeChild(B),window.URL.revokeObjectURL(R),s("Devices exported to JSON successfully",{variant:"success"}),q(null)}catch(r){console.error("Error exporting JSON:",r),s("Failed to export devices to JSON",{variant:"error"})}},ts=async r=>{const o=r.target.files[0];if(o){K(!0);try{const h=await Ws(o);h.success?(s(h.message,{variant:"success"}),h.errors&&h.errors.length>0&&s(`${h.total_errors} rows had errors`,{variant:"warning"}),await J()):s("Import failed",{variant:"error"})}catch(h){console.error("Error importing devices:",h),s(h.message||"Failed to import devices",{variant:"error"})}finally{K(!1),r.target.value=""}}};return e.jsxs(e.Fragment,{children:[e.jsxs(Is,{maxWidth:p.themeStretch?!1:"xl",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"24px"},children:[e.jsx(U,{component:Se,onClick:()=>J(),variant:"contained",color:"primary",startIcon:e.jsx(D,{src:"/assets/icons/setting/ic_retry.svg"}),children:"Rediscover devices"})," ",e.jsx(U,{component:Se,onClick:()=>{de(null),M.onTrue()},variant:"contained",color:"primary",startIcon:e.jsx(se,{src:"/assets/icons/home/ic_add_line.svg"}),children:"Add Manual"}),e.jsx("input",{ref:re,type:"file",accept:".csv,.json",style:{display:"none"},onChange:ts})]}),e.jsxs(ks,{children:[e.jsx(Oe,{filters:a,onFilters:ve,deviceTypeOptions:X,publishOptions:hn,levelListOptions:m}),W&&e.jsx($e,{filters:a,onFilters:ve,onResetFilters:es,results:L.length,sx:{p:2.5,pt:0}}),e.jsxs(Ps,{sx:{position:"relative",overflow:"unset"},children:[e.jsx(Rs,{dense:t.dense,numSelected:t.selected.length,rowCount:l.length,onSelectAllRows:r=>t.onSelectAllRows(r,l.map(o=>o.id)),action:e.jsx(N,{title:"Delete",children:e.jsx(oe,{color:"primary",onClick:Z.onTrue,children:e.jsx(se,{src:"/assets/icons/home/ic_trash_bin.svg"})})}),addAction:e.jsx(N,{title:"Add",children:e.jsx(oe,{color:"primary",onClick:Q.onTrue,children:e.jsx(se,{src:"/assets/icons/home/ic_add_line.svg"})})})}),e.jsx(Es,{children:e.jsxs(Ns,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Ls,{order:t.order,orderBy:t.orderBy,headLabel:pn,rowCount:l.length,numSelected:t.selected.length,onSort:t.onSort,onSelectAllRows:r=>t.onSelectAllRows(r,l.map(o=>o.id))}),e.jsxs(Fs,{children:[c&&!j?[...Array(t.rowsPerPage)].map((r,o)=>e.jsx(Ms,{sx:{height:_}},o)):e.jsx(e.Fragment,{children:!j&&L.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map(r=>e.jsx(He,{row:r,selected:t.selected.includes(r.id),onSelectRow:()=>t.onSelectRow(r.id),onAddRow:()=>Qe(r),onEditRow:()=>Xe(r),onViewRow:()=>Ke(r),onDeleteRow:()=>Ge(r)},r.id))}),e.jsx(Os,{height:_,emptyRows:$s(t.page,t.rowsPerPage,l.length)}),e.jsx(zs,{notFound:j})]})]})})]}),e.jsx(Bs,{count:L.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})]}),e.jsx(ue,{open:G.value,onClose:G.onFalse,title:"Delete Device",content:e.jsx(e.Fragment,{children:"Are you sure want to delete the device?"}),action:e.jsx(U,{variant:"contained",color:"error",onClick:()=>{Ze(),G.onFalse()},children:"Delete"})}),e.jsx(ue,{open:Z.value,onClose:Z.onFalse,title:"Delete Devices",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",t.selected.length," "]})," devices?"]}),action:e.jsx(U,{variant:"contained",color:"error",onClick:()=>{Je(),Z.onFalse()},children:"Delete"})}),e.jsx(ue,{open:Q.value,onClose:Q.onFalse,title:"Add Devices",content:e.jsxs(e.Fragment,{children:["Are you sure want to add ",e.jsxs("strong",{children:[" ",t.selected.length," "]})," devices?"]}),action:e.jsx(U,{variant:"contained",color:"success",onClick:()=>{Ye(),Q.onFalse()},children:"Add"})}),e.jsx(Ue,{open:u.value,device:k,onClose:u.onFalse,levelList:m}),e.jsx(Be,{open:M.value,onClose:()=>{de(null),M.onFalse()},device:Ve,levelList:m}),e.jsxs(Hs,{anchorEl:w,open:!!w,onClose:()=>q(null),children:[e.jsxs(C,{onClick:ss,children:[e.jsx(se,{src:"/assets/icons/files/ic_excel.svg",sx:{mr:1,width:20,height:20}}),"Export as CSV"]}),e.jsxs(C,{onClick:ns,children:[e.jsx(se,{src:"/assets/icons/files/ic_js.svg",sx:{mr:1,width:20,height:20}}),"Export as JSON"]})]})]})}function gn({inputData:s,comparator:t,filters:p}){const{searchFilter:l,deviceType:g,levelTypeList:a}=p,x=s.map((i,b)=>[i,b]);return x.sort((i,b)=>{const c=t(i[0],b[0]);return c!==0?c:i[1]-b[1]}),s=x.map(i=>i[0]),l&&(s=s.filter(i=>i.deviceName.toLowerCase().indexOf(l.toLowerCase())!==-1||i.ipAddress.toLowerCase().indexOf(l.toLowerCase())!==-1||i.macId.toLowerCase().indexOf(l.toLowerCase())!==-1)),g.length&&(s=s.filter(i=>g.includes(i.moduleName))),a.length&&(s=s.filter(i=>a.includes(i.custom_field_id))),s}n.object;n.array;n.func;n.array,n.array,n.number,n.number;const bn=d.forwardRef(({quantity:s,onIncrease:t,onDecrease:p,disabledIncrease:l,disabledDecrease:g,sx:a,...x},i)=>e.jsxs(V,{ref:i,flexShrink:0,direction:"row",alignItems:"center",justifyContent:"space-between",sx:{p:.5,width:88,borderRadius:1,typography:"subtitle2",border:b=>`solid 1px ${Me(b.palette.grey[500],.2)}`,...a},...x,children:[e.jsx(oe,{size:"small",onClick:p,disabled:g,sx:{borderRadius:.75},children:e.jsx(D,{icon:"eva:minus-fill",width:16})}),s,e.jsx(oe,{size:"small",onClick:t,disabled:l,sx:{borderRadius:.75},children:e.jsx(D,{icon:"mingcute:add-line",width:16})})]}));bn.propTypes={disabledDecrease:n.bool,disabledIncrease:n.bool,onDecrease:n.func,onIncrease:n.func,quantity:n.number,sx:n.object};n.array,n.bool,n.func,n.func,n.object;n.string,n.string,n.string,n.func,n.string,n.array,n.object;const ne=64;Zs("div")(({length:s,theme:t})=>({position:"relative",margin:t.spacing(0,"auto"),"& .slick-slide":{lineHeight:0},...s===1&&{maxWidth:ne*1+16},...s===2&&{maxWidth:ne*2+32},...(s===3||s===4)&&{maxWidth:ne*3+48},...s>=5&&{maxWidth:ne*6},...s>3&&{"&:before, &:after":{...Gs({direction:"to left",startColor:`${Me(t.palette.background.default,0)} 0%`,endColor:`${t.palette.background.default} 100%`}),top:0,zIndex:9,content:"''",height:"100%",position:"absolute",width:ne*2/3},"&:after":{right:0,transform:"scaleX(-1)"}}}));n.object;n.string;n.string;n.string;function An(){return e.jsxs(e.Fragment,{children:[e.jsx(Qs,{children:e.jsx("title",{children:" Devices"})}),e.jsx(xn,{})]})}export{An as default};
