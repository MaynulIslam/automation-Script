import{q as o,b as L,bG as Z,t as ee,j as e,D as N,C as se,B as w,x as te,aw as ae,S as E,T as I,z as ne,aN as re,Q as le,e as oe,f as ie,r as c,bH as ce,U as de,bC as R,ax as ue,X as he,Z as j,w as F,aJ as xe,bc as ge,aK as pe,aE as me,bI as be,bJ as _e,bK as fe,aq as ye,ar as je,as as Ce,at as ve,au as we,bL as Te,bM as Se,bN as Pe,av as De,bO as Oe,bP as Re,ao as Fe,br as ke,bF as Ee,bQ as Le,a2 as Ne,bR as Ae,bS as G,W as Be}from"./index-b5422eae.js";import"./chart-heatmap-4c6f2f85.js";o.string,o.oneOfType([o.element,o.string]),o.object,o.string,o.number;o.object,o.string,o.string;function H({title:a,subheader:t,chart:h,numberOfSensors:x,numberOfSensorsTypes:u,..._}){const n=L(),m=Z("up","sm"),{colors:f,series:b,options:r}=h,g=b.map(y=>y.value),C=ee({colors:f,labels:b.map(y=>y.label),stroke:{colors:[n.palette.background.paper]},fill:{opacity:1},yaxis:{labels:{style:{colors:[],fontSize:"12px",fontFamily:"Helvetica, Arial, sans-serif",fontWeight:500,cssClass:"apexcharts-yaxis-label"},formatter:y=>parseInt(y)}},legend:{position:"right",itemMargin:{vertical:7}},tooltip:{fillSeriesColor:!0},responsive:[{breakpoint:n.breakpoints.values.sm,options:{legend:{position:"bottom",horizontalAlign:"left"}}}],...r});return e.jsxs(N,{..._,children:[e.jsx(se,{title:a,subheader:t}),e.jsx(w,{sx:{my:5,"& .apexcharts-legend":{m:"auto",height:{sm:160},flexWrap:{sm:"wrap"},width:{xs:240,sm:"50%"}},"& .apexcharts-datalabels-group":{display:"none"}},children:e.jsx(te,{dir:"ltr",type:"polarArea",series:g,options:C,height:m?240:360})}),e.jsx(ae,{sx:{borderStyle:"dashed"}}),e.jsxs(w,{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",sx:{textAlign:"center",typography:"h4"},children:[e.jsxs(E,{sx:{py:2,borderRight:`dashed 1px ${n.palette.divider}`},children:[e.jsx(w,{component:"span",sx:{mb:1,typography:"body2",color:"text.secondary"},children:"Number of Sensors"}),x]}),e.jsxs(E,{sx:{py:2},children:[e.jsx(w,{component:"span",sx:{mb:1,typography:"body2",color:"text.secondary"},children:"Number of Gas Types"}),u]})]})]})}H.propTypes={chart:o.object,subheader:o.string,title:o.string};o.bool,o.object,o.func,o.func;function T({title:a,percent:t,total:h,chart:x,icon:u,sx:_,...n}){return L(),e.jsxs(N,{sx:{display:"flex",alignItems:"center",p:3,..._},...n,children:[e.jsxs(w,{sx:{flexGrow:1},children:[e.jsx(I,{variant:"subtitle2",children:a}),e.jsx(E,{direction:"row",alignItems:"center",sx:{mt:2,mb:1}}),e.jsx(I,{variant:"h3",children:ne(h)})]}),u]})}T.propTypes={chart:o.object,percent:o.number,sx:o.object,title:o.string,total:o.number};const Ie=[{value:"all",label:"All"},{value:"cal_error",label:"Calibration Error"},{value:"past_due",label:"Past Due"},{value:"next_7",label:"Next 7 Days"},{value:"next_30",label:"Next 30 Days"},{value:"next_60",label:"Next 60 Days"}],Ge=[{id:"serial_number",label:"Serial Number",maxWidth:50},{id:"gas_sensor_name",label:"Gas Type",minWidth:120},{id:"location",label:"Location",minWidth:100,align:"center"},{id:"device_name",label:"Device Name",minWidth:150,align:"center"},{id:"last_calibration_date",label:"Last Calibrated Date",align:"center"},{id:"gas_sensor_status",label:"Gas Sensor Status"},{id:"calibration_due_date",label:"Due Date"}],We=[{value:"published",label:"Published"},{value:"draft",label:"Draft"}],W={searchFilter:"",deviceTypeOptions:[],deviceType:[],sensorTypeOptions:[],sensorType:[],status:"all"};function k(a,t){const h=[];for(let x=0;x<a;x++){const u=Math.floor(Math.random()*(t.max-t.min+1))+t.min;h.push({x:`${x+1}`,y:u})}return h}function He(){const a=L(),t=re({defaultOrderBy:"calibration_due_date",defaultDense:!1}),h=le(),x=oe(),u=ie(),_=ke,[n,m]=c.useState([]),[f,b]=c.useState([]),[r,g]=c.useState("All Gas Types"),[C,y]=c.useState(!0);c.useState(null);const[i,A]=c.useState(W),M=i.startDate&&i.endDate?i.startDate.getTime()>i.endDate.getTime():!1,d=Me({inputData:n,comparator:Ee(t.order,t.orderBy),filters:i,dateError:M}),S=d.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage),U=t.dense?52:72,B=!!i.name||i.status!=="all"||!!i.startDate&&!!i.endDate||i.deviceType.length||i.sensorType.length>0,J=!d.length&&B||!d.length,P=c.useCallback((s,l)=>{t.onResetPage(),A(p=>({...p,[s]:l})),s=="status"&&g(l==="all"?"All Gas Types":l==="next_7"?"Next 7 Days":l==="next_30"?"Next 30 Days":l==="next_60"?"Next 60 Days":l==="past_due"?"Past Due":"Calibration Error")},[t]),z=c.useCallback(s=>{const l=n.filter(p=>p.id!==s);m(l),t.onUpdatePageDeleteRow(S.length)},[S.length,t,n]),V=c.useCallback(()=>{const s=n.filter(l=>!t.selected.includes(l.id));m(s),t.onUpdatePageDeleteRows({totalRows:n.length,totalRowsInPage:S.length,totalRowsFiltered:d.length})},[d.length,S.length,t,n]),q=c.useCallback(()=>{A(W)},[]),Q=c.useCallback(s=>{x.push(ce.dashboard.order.details(s))},[x]),Y=c.useCallback((s,l)=>{P("status",l)},[P]);c.useState([{name:"Jan",data:k(31,{min:0,max:15})},{name:"Feb",data:k(31,{min:0,max:25})},{name:"Mar",data:k(31,{min:0,max:35})},{name:"Apr",data:k(31,{min:0,max:45})}]);let v=de(["maestrolink/calibration/gas"]);return c.useEffect(()=>(v&&v.on("message",(s,l)=>{let p=JSON.parse(l),D=!1;if(m(O=>JSON.stringify(O)!==JSON.stringify(p)?(D=!0,p):O),D){const O=R.groupBy(p,"gas_sensor_name"),$=R.map(O,(K,X)=>({label:X,value:K.length}));b($)}y(!1)}),()=>{v&&(v.end(),v=null)}),[v]),c.useEffect(()=>{if(d){const s=R.groupBy(d,"gas_sensor_name"),l=R.map(s,(p,D)=>({label:D,value:p.length}));b(l)}},[d]),e.jsx(e.Fragment,{children:C?e.jsx(ue,{}):e.jsx(he,{maxWidth:h.themeStretch?!1:"xl",children:e.jsxs(j,{container:!0,spacing:3,children:[e.jsx(j,{xs:12,md:3,children:e.jsx(T,{title:"Healthy Sensors",percent:2.6,total:n.length>0?n.filter(s=>!s.gas_sensor_status.includes("Fault")&&!s.gas_sensor_status.includes("Disconnected")).length:0,icon:e.jsx(F,{src:"/assets/icons/home/ic_approval.svg",sx:{width:70,height:70}})})}),e.jsx(j,{xs:12,md:3,children:e.jsx(T,{title:"Next 7 Days",percent:.2,total:n.length>0?n.filter(s=>s.cal_status==="next_7").length:0,icon:e.jsx(F,{sx:{width:70,height:70},src:"/assets/icons/home/ic_planner.svg"})})}),e.jsx(j,{xs:12,md:3,children:e.jsx(T,{title:"Calibration Overdue",percent:-.1,total:n.length>0?n.filter(s=>s.cal_status==="past_due").length:0,icon:e.jsx(F,{sx:{width:70,height:70},src:"/assets/icons/home/ic_expired.svg"})})}),e.jsx(j,{xs:12,md:3,children:e.jsx(T,{title:"Calibration Error",percent:-.1,total:n.length>0?n.filter(s=>s.gas_sensor_status.includes("Fault")).length:0,icon:e.jsx(F,{sx:{width:70,height:70},src:"/assets/icons/home/ic_cancel.svg"})})}),e.jsx(j,{item:!0,xs:12,md:8,children:e.jsxs(N,{children:[e.jsx(xe,{value:i.status,onChange:Y,sx:{px:2.5,boxShadow:s=>`inset 0 -2px 0 0 ${ge(s.palette.grey[500],.08)}`,backgroundColor:a.palette.primary.main},children:Ie.map(s=>e.jsx(pe,{iconPosition:"end",value:s.value,label:s.label,icon:e.jsxs(me,{variant:(s.value==="all"||s.value===i.status)&&"filled"||"soft",color:s.value==="next_30"&&"success"||s.value==="next_7"&&"info"||s.value==="past_due"&&"warning"||s.value==="cal_error"&&"error"||"default",children:[s.value==="all"&&n.length,s.value==="next_30"&&n.filter(l=>l.cal_status==="next_30"||l.cal_status==="next_7").length,s.value==="next_7"&&n.filter(l=>l.cal_status==="next_7").length,s.value==="past_due"&&n.filter(l=>l.cal_status==="past_due").length,s.value==="next_60"&&n.filter(l=>l.cal_status==="next_30"||l.cal_status==="next_7"||l.cal_status==="next_60").length,s.value==="cal_error"&&n.filter(l=>l.gas_sensor_status.includes("Fault")).length]})},s.value))}),e.jsx(be,{filters:i,onFilters:P,deviceTypeOptions:_e.filter(s=>s.value.includes("AQI")),publishOptions:We,sensorTypeOptions:_}),B&&e.jsx(fe,{filters:i,onFilters:P,onResetFilters:q,results:d.length,sx:{p:2.5,pt:0}}),e.jsx(ye,{sx:{position:"relative",overflow:"unset"},children:e.jsx(je,{children:e.jsxs(Ce,{size:t.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ve,{order:t.order,orderBy:t.orderBy,headLabel:Ge,rowCount:n.length,onSort:t.onSort}),e.jsxs(we,{children:[d.slice(t.page*t.rowsPerPage,t.page*t.rowsPerPage+t.rowsPerPage).map(s=>e.jsx(Te,{row:s,onDeleteRow:()=>z(s.id),onViewRow:()=>Q(s.id)},s.id)),e.jsx(Se,{height:U,emptyRows:Pe(t.page,t.rowsPerPage,n.length)}),e.jsx(De,{notFound:J})]})]})})}),e.jsx(Oe,{count:d.length,page:t.page,rowsPerPage:t.rowsPerPage,onPageChange:t.onChangePage,onRowsPerPageChange:t.onChangeRowsPerPage,dense:t.dense,onChangeDense:t.onChangeDense})]})}),e.jsx(j,{item:!0,xs:12,md:4,children:e.jsx(H,{title:r,numberOfSensors:d.length,numberOfSensorsTypes:f.length,chart:{series:f,colors:[a.palette.primary.main,a.palette.warning.dark,a.palette.success.darker,a.palette.error.main,a.palette.info.dark,a.palette.info.darker,a.palette.success.main,a.palette.warning.main,a.palette.info.main]}})}),e.jsx(Re,{open:u.value,onClose:u.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",t.selected.length," "]})," items?"]}),action:e.jsx(Fe,{variant:"contained",color:"error",onClick:()=>{V(),u.onFalse()},children:"Delete"})})]})})})}function Me({inputData:a,comparator:t,filters:h,dateError:x}){const{status:u,deviceType:_,searchFilter:n,sensorType:m}=h;n&&(a=a.filter(r=>r.device_name.toLowerCase().indexOf(n.toLowerCase())!==-1||r.gas_sensor_name.toLowerCase().indexOf(n.toLowerCase())!==-1||r.device_name.toLowerCase().indexOf(n.toLowerCase())!==-1||r.gas_sensor_name.toLowerCase().indexOf(n.toLowerCase())!==-1||r.location.toLowerCase().indexOf(n.toLowerCase())!==-1||r.gas_sensor_status.toLowerCase().indexOf(n.toLowerCase())!==-1)),Le.forEach(r=>{_.includes(r.type_code)&&(a=a.filter(g=>g.device_type_id===r.id))}),m.length&&(a=a.filter(r=>m.includes(r.sensor_type)));const f=a.map((r,g)=>[r,g]);f.sort((r,g)=>{const C=t(r[0],g[0]);return C!==0?C:r[1]-g[1]}),a=f.map(r=>r[0]);const b=Ne(Ae(new Date),1);switch(G(b,{days:7}),G(b,{days:30}),u){case"cal_error":a=a.filter(r=>r.gas_sensor_status.includes("Fault"));break;case"past_due":a=a.filter(r=>r.cal_status==="past_due");break;case"next_7":a=a.filter(r=>r.cal_status==="next_7");break;case"next_30":a=a.filter(r=>r.cal_status==="next_30"||r.cal_status==="next_7");break;case"next_60":a=a.filter(r=>r.cal_status==="next_30"||r.cal_status==="next_7"||r.cal_status==="next_60");break}return a}function Ve(){return e.jsxs(e.Fragment,{children:[e.jsx(Be,{children:e.jsx("title",{children:" Dashboard: Analytics"})}),e.jsx(He,{})]})}export{Ve as default};
