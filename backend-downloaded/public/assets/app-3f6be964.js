import{q as t,b as F,s as xe,r as j,t as G,j as e,B as Y,C as k,v as fe,w as ce,x as B,y as ye,M as ae,z as T,D as $,T as E,S as be,H as je,J as ve,K as De,N as de,O as pe,Q as we,U as Ce,V as O,X as _e,Y as se,A as Me,Z as v,_ as re,$ as Ae,a0 as Se,a1 as I,a2 as P,a3 as z,a4 as ne,W as ke}from"./index-b5422eae.js";import"./carousel-arrow-index-2fd86e94.js";import"./_baseToString-ddfaf6f7.js";import{C as A}from"./CardContent-4a131abb.js";import"./chart-radial-bar-367ea955.js";import{C as Te}from"./chart-heatmap-4c6f2f85.js";import"./ResizeObserver.es-eef8c2d8.js";t.object,t.string,t.oneOfType([t.element,t.string]),t.object,t.string,t.number;t.node,t.string,t.node,t.string;t.array;t.bool,t.object;t.string,t.array,t.array,t.string;t.object;t.array,t.string,t.string;t.object,t.number;t.array,t.string,t.string;t.object;function me({title:s,subheader:i,chart:l,height:h=364,onTimeframeChange:c,...m}){const d=F(),{colors:b=[[d.palette.primary.light,d.palette.primary.main],[d.palette.warning.light,d.palette.warning.main]],categories:g,series:u,options:o}=l,n=xe(),[a,C]=j.useState("Monthly"),w=G({colors:[d.palette.success.main,d.palette.warning.main,d.palette.error.main],fill:{opacity:1},xaxis:{categories:g},chart:{type:"bar",height:h,stacked:!0,zoom:{enabled:!0},toolbar:{show:!1}},responsive:[{breakpoint:480,options:{legend:{position:"bottom",offsetX:-10,offsetY:0}}}],...o}),_=j.useCallback(N=>{n.onClose(),C(N),c&&c(N==="Monthly"?"monthly":"yearly")},[n,c]);return e.jsxs(e.Fragment,{children:[e.jsxs(Y,{...m,children:[e.jsx(k,{title:s,subheader:i,action:e.jsxs(fe,{onClick:n.onOpen,sx:{pl:1,py:.5,pr:.5,borderRadius:1,typography:"subtitle2",bgcolor:"background.neutral"},children:[a,e.jsx(ce,{width:16,icon:n.open?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill",sx:{ml:.5}})]})}),e.jsx(Y,{sx:{mt:3,mx:3},children:e.jsx(B,{dir:"ltr",type:"bar",series:u[0].data,options:w,height:h})})]}),e.jsxs(ye,{open:n.open,onClose:n.onClose,sx:{width:140},children:[e.jsx(ae,{selected:a==="Monthly",onClick:()=>_("Monthly"),children:"Monthly"}),e.jsx(ae,{selected:a==="Yearly",onClick:()=>_("Yearly"),children:"Yearly"})]})]})}me.propTypes={chart:t.object,subheader:t.string,title:t.string,height:t.number,onTimeframeChange:t.func};function S({title:s,percent:i,total:l,chart:h,sx:c,...m}){const d=F(),{colors:b=[d.palette.primary.light,d.palette.primary.main],series:g,options:u}=h,o={colors:[d.palette.primary.light],chart:{sparkline:{enabled:!0}},plotOptions:{bar:{columnWidth:"68%",borderRadius:2}},tooltip:{x:{show:!1},y:{formatter:n=>T(n),title:{formatter:()=>""}},marker:{show:!1}},...u};return e.jsxs($,{sx:{display:"flex",alignItems:"center",p:3,...c},...m,children:[e.jsxs(Y,{sx:{flexGrow:1},children:[e.jsx(E,{variant:"subtitle2",children:s}),e.jsxs(be,{direction:"row",alignItems:"center",sx:{mt:2,mb:1},children:[e.jsx(ce,{width:24,icon:i<0?"solar:double-alt-arrow-down-bold-duotone":"solar:double-alt-arrow-up-bold-duotone",sx:{mr:1,color:"success.main",...i<0&&{color:"error.main"}}}),e.jsxs(E,{component:"div",variant:"subtitle2",children:[i>0&&"+",je(i)]})]}),e.jsx(E,{variant:"h3",children:T(l)})]}),e.jsx(B,{type:"area",series:[{data:g}],options:o,width:150,height:36})]})}S.propTypes={chart:t.object,percent:t.number,sx:t.object,title:t.string,total:t.number};const oe=400,ie=72;De(B)(({theme:s})=>({height:oe,"& .apexcharts-canvas, .apexcharts-inner, svg, foreignObject":{height:"100% !important"},"& .apexcharts-legend":{height:ie,borderTop:`dashed 1px ${s.palette.divider}`,top:`calc(${oe-ie}px) !important`}}));function W({title:s,subheader:i,chart:l,...h}){const c=F(),{colors:m,series:d,options:b}=l,g=d.map(a=>a.value),u=d.map(a=>a.label),o=d.map(a=>a.color),n=G({chart:{height:300,sparkline:{enabled:!0}},colors:m,labels:d.map(a=>a.label),stroke:{colors:[c.palette.background.paper]},legend:{offsetY:0,floating:!0,position:"bottom",horizontalAlign:"center"},tooltip:{fillSeriesColor:!1,y:{formatter:a=>T(a),title:{formatter:a=>`${a}`}}},plotOptions:{pie:{donut:{size:"90%",labels:{value:{formatter:a=>T(a)},total:{formatter:a=>{const C=a.globals.seriesTotals.reduce((w,_)=>w+_,0);return T(C)}}}}}},...b});return e.jsxs($,{...h,children:[e.jsx(k,{title:s,subheader:i,sx:{mb:5}}),e.jsx(A,{sx:{flex:1,display:"flex",mb:2,alignItems:"center",justifyContent:"center"},children:e.jsx(ve,{dir:"ltr",type:"donut",series:g,labels:u,options:n,colors:o})})]})}W.propTypes={chart:t.object,subheader:t.string,title:t.string};t.array,t.string,t.string;t.object;function $e({chart:s,height:i=300}){const l=F(),h=s.colors??[l.palette.error.dark,l.palette.warning.dark,l.palette.error.main],c=G({colors:h,legend:{show:!0},dataLabels:{enabled:!0},tooltip:{x:{show:!1}}});return e.jsx(B,{type:"treemap",series:s.series,options:c,height:i})}async function Ee(s){try{let i=`${de.alarmreport.getAlarmSummaryByCategory}?${s}`;return(await pe.get(i)).response}catch(i){throw console.error("error",i),i}}async function Oe(s,i){try{return await pe.get(`${de.sensorAlarm.getAlarmTrends}?date=${s}&timeframe=${i}`)}catch(l){return console.error("API Error:",l),null}}function le(s){if(!s||s.length===0)return[];const i=new Date,l=[];for(let c=0;c<4;c++){const m=new Date(i);m.setMonth(i.getMonth()-c),l.push({date:m,name:O(m,"MMM"),startDate:Ae(m),endDate:Se(m)})}const h=s.filter(c=>c.cal_status==="past_due"||c.gas_sensor_status&&c.gas_sensor_status.includes("Fault"));return l.map(c=>{const m=new Date(c.startDate),d=[];let b=m;for(;I(b,c.endDate);){const g=I(P(b,6),c.endDate)?P(b,6):c.endDate;d.push({start:b,end:g,label:`W${Math.ceil(b.getDate()/7)}`}),b=P(g,1)}return{name:c.name,data:d.map(g=>{const u={due:0,pastDue:0,sensors:[]};h.length>0&&!z(g.end,i)&&h.forEach(n=>{try{const a=ne(n.calibration_due_date);z(g.end,a)&&(u.pastDue+=1,u.sensors.push({name:n.gas_sensor_name,deviceName:n.device_name,status:n.cal_status,dueDate:O(a,"MMM dd, yyyy"),isPastDue:!0}))}catch(a){console.error("Error processing sensor date:",a)}}),s.forEach(n=>{try{if(n.cal_status==="past_due"||n.gas_sensor_status&&n.gas_sensor_status.includes("Fault"))return;const a=ne(n.calibration_due_date);z(a,g.start)&&I(a,g.end)&&(u.due+=1,u.sensors.push({name:n.gas_sensor_name,deviceName:n.device_name,status:n.cal_status,dueDate:O(a,"MMM dd, yyyy"),isPastDue:!1}))}catch(a){console.error("Error processing sensor date:",a)}});const o=u.due+u.pastDue;return{x:g.label,y:o,pastDue:u.pastDue,upcoming:u.due,sensors:u.sensors}})}})}function Fe(s,i,l,h){const c=s[i][l],m=h.globals.seriesNames[i],d=h.globals.labels[l],b=h.config.series[i].data[l].pastDue||0,g=h.config.series[i].data[l].upcoming||0,u=h.config.series[i].data[l].sensors||[];let o="";return c===0?o=`<div style="padding: 8px; min-width: 150px;">
      <div style="font-weight: bold; margin-bottom: 4px;">${m} ${d}</div>
      <div>No calibrations due</div>
    </div>`:(o=`<div style="padding: 8px; min-width: 200px;">
      <div style="font-weight: bold; margin-bottom: 4px;">${m} ${d}</div>`,b>0&&(o+=`<div style="color: #FF4560; margin-bottom: 2px;"><strong>Past Due: ${b}</strong></div>`),g>0&&(o+=`<div style="color: #FEB019; margin-bottom: 2px;"><strong>Upcoming: ${g}</strong></div>`),u.length>0&&(o+='<div style="margin-top: 6px; border-top: 1px solid #eee; padding-top: 6px;">',u.forEach(n=>{const a=n.isPastDue?"#FF4560":"#FEB019";o+=`<div style="margin-bottom: 4px; font-size: 11px;">
          <div style="color: ${a}; font-weight: bold;">${n.name}</div>
          <div>Device: ${n.deviceName}</div>
          <div>Due: ${n.dueDate}</div>
          <div>Status: ${n.status}</div>
        </div>`}),o+="</div>"),o+="</div>"),o}function Ne(){var U,L,J,Z,q,R,V,X,K,Q,ee,te;const s=F(),i=we(),[l,h]=j.useState({alarm:15,warning:10,normal:39}),m=Ce(["duettoanalytics/keyfigures/sensoralarm","maestrolink/calibration/gas"]),[d,b]=j.useState([]),[g,u]=j.useState(()=>{const r=new Date,x=[];for(let y=0;y<4;y++){const p=new Date(r);p.setMonth(r.getMonth()-y);const M=O(p,"MMM"),D=new Date(p.getFullYear(),p.getMonth()+1,0).getDate(),f=Math.ceil(D/7);x.push({name:M,data:Array(f).fill().map((H,ge)=>({x:`W${ge+1}`,y:0,pastDue:0,upcoming:0,sensors:[]}))})}return x.reverse()}),[o,n]=j.useState([]);j.useState({healthy:0,overdue:0,error:0});const[a,C]=j.useState({categories:[],series:[]}),[w,_]=j.useState("monthly"),N=r=>{if(!r||!Array.isArray(r))return[];const y=r.filter(p=>p.total_count>0&&p.AlarmCategory&&p.AlarmCategory.is_failure===!0).reduce((p,M)=>{const D=M.AlarmCategory.category_name;return p[D]||(p[D]=[]),p[D].push({x:M.AlarmCategory.subcategory_name,y:M.total_count}),p},{});return Object.keys(y).map(p=>({name:p,data:y[p]}))},ue=async()=>{let r=await Ee("start_date=2025-02-24T00:00:00.000Z&end_date=2025-03-02T23:59:59.999Z");if(r&&r.alarm_report&&r.alarm_report){const x=N(r.alarm_report);b(x)}},he=async()=>{const r=O(new Date,"yyyy-MM-dd"),x=await Oe(r,w==="monthly"?"monthly":"yearly");if(console.log("alarm trends",x),x!=null&&x.status&&(x!=null&&x.data)){const{graph_data:y}=x.data,p=w==="yearly"?[...y].sort((f,H)=>f.name-H.name):y,D=p.some(f=>f.normal>0||f.warning>0||f.alarm>0)?p:p.map((f,H)=>({name:f.name,normal:Math.floor(Math.random()*100)+50,warning:Math.floor(Math.random()*80)+20,alarm:Math.floor(Math.random()*50)+10}));console.log("timeframe",w),C({categories:D.map(f=>f.name.toString()),series:[{data:[{name:"Normal",data:D.map(f=>f.normal)},{name:"Warning",data:D.map(f=>f.warning)},{name:"Alarm",data:D.map(f=>f.alarm)}]}]})}};return j.useEffect(()=>{ue()},[]),j.useEffect(()=>(m&&m.on("message",(r,x)=>{if(r==="duettoanalytics/keyfigures/sensoralarm"){let y=JSON.parse(x);h(y)}else if(r==="maestrolink/calibration/gas")try{let y=JSON.parse(x);n(y);const p=le(y);p.length>0&&u(p)}catch(y){console.error("Error processing calibration data:",y)}}),()=>{m&&m.end()}),[m]),j.useEffect(()=>{he()},[w]),j.useEffect(()=>{if(o.length>0){const r=le(o);u(r)}},[o]),e.jsxs(_e,{maxWidth:i.themeStretch?!1:"xl",children:[e.jsx(se,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(Me,{variant:"outlined",severity:"warning",sx:{mb:3},children:"This page is under development"})}),e.jsxs(v,{container:!0,spacing:3,children:[e.jsx(v,{xs:12,md:3,children:e.jsx(S,{title:"Total Active Devices",percent:2.6,total:28,chart:{series:[5,18,12,51,68,11,39,37,27,20]}})}),e.jsx(v,{xs:12,md:3,children:e.jsx(S,{title:"Total Active Sensors",percent:.2,total:60,chart:{colors:[s.palette.info.light,s.palette.info.main],series:[20,41,63,33,28,35,50,46,11,26]}})}),e.jsx(v,{xs:12,md:3,children:e.jsx(S,{title:"Avg Device Up Time",percent:-.1,total:2.5,chart:{colors:[s.palette.warning.light,s.palette.warning.main],series:[8,9,31,8,16,37,8,33,46,31]}})}),e.jsx(v,{xs:12,md:3,children:e.jsx(S,{title:"Avg Sensor Up Time",percent:-.1,total:7,chart:{colors:[s.palette.warning.light,s.palette.warning.main],series:[8,9,31,8,16,37,8,33,46,31]}})}),e.jsx(v,{xs:12,md:4,children:e.jsx(W,{title:"Alarm Overview",chart:{series:[{label:"Alarm",value:l.alarm,color:s.palette.error.dark},{label:"Warning",value:l.warning,color:s.palette.warning.main},{label:"Normal",value:l.normal,color:s.palette.success.main}]}})}),e.jsx(v,{xs:12,md:4,children:e.jsx(W,{title:"Station Connectivity",chart:{series:[{label:"Online",value:18,color:s.palette.success.main},{label:"Maintenance",value:3,color:s.palette.warning.main},{label:"Error",value:2,color:s.palette.error.dark}]}})}),e.jsx(v,{xs:12,md:4,children:e.jsx(W,{title:"Calibration Overview",chart:{series:[{label:"Healthy",value:o.length>0?o.filter(r=>!r.gas_sensor_status.includes("Fault")&&!r.gas_sensor_status.includes("Disconnected")&&r.cal_status==="normal").length:0,color:s.palette.success.main},{label:"Next 7 Days",value:o.length>0?o.filter(r=>r.cal_status==="next_7").length:0,color:s.palette.warning.main},{label:"Past Due",value:o.length>0?o.filter(r=>r.cal_status==="past_due").length+o.filter(r=>r.gas_sensor_status.includes("Fault")).length:0,color:s.palette.error.dark}]}})}),e.jsx(v,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(k,{title:"Calibration Timeline"}),e.jsx(A,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(Te,{series:g,options:{colors:["#C2DFFF","#2E86C1","#FF4560"],tooltip:{custom:Fe}}})}),e.jsxs(A,{children:[e.jsxs(se,{sx:{display:"flex",justifyContent:"center",gap:3,flexWrap:"wrap"},children:[e.jsx(re,{color:"error",label:`Past Due (${o.filter(r=>r.cal_status==="past_due").length})`,sx:{height:24,"& .MuiChip-label":{fontSize:"0.75rem"}}}),e.jsx(re,{color:"warning",label:"Upcoming Due Date",sx:{height:24,"& .MuiChip-label":{fontSize:"0.75rem"}}})]}),e.jsx(E,{variant:"caption",sx:{display:"block",textAlign:"center",mt:1},children:"Historical calibration timeline showing past due sensors as they appeared each week"}),e.jsxs(E,{variant:"caption",sx:{display:"block",textAlign:"center"},children:["Total sensors: ",o.length]})]})]})}),e.jsx(v,{item:!0,xs:12,md:6,children:e.jsxs($,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsx(k,{title:"Alarm Overview"}),e.jsx(A,{sx:{flex:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:e.jsx(me,{height:300,onTimeframeChange:r=>{_(r)},chart:{categories:a.categories||[],series:[{data:[{name:"Normal",data:((Z=(J=(L=(U=a==null?void 0:a.series)==null?void 0:U[0])==null?void 0:L.data)==null?void 0:J[0])==null?void 0:Z.data)||[]},{name:"Warning",data:((X=(V=(R=(q=a==null?void 0:a.series)==null?void 0:q[0])==null?void 0:R.data)==null?void 0:V[1])==null?void 0:X.data)||[]},{name:"Alarm",data:((te=(ee=(Q=(K=a==null?void 0:a.series)==null?void 0:K[0])==null?void 0:Q.data)==null?void 0:ee[2])==null?void 0:te.data)||[]}]}]}})})]})}),e.jsx(v,{xs:12,md:12,children:e.jsxs($,{children:[e.jsx(k,{title:"Failure Analysis"}),e.jsx(A,{children:e.jsx($e,{chart:{series:d.length>0?d:[{name:"No Failure Data",data:[{x:"No failures found",y:1}]}]}})})]})})]})]})}function Ge(){return e.jsxs(e.Fragment,{children:[e.jsx(ke,{children:e.jsx("title",{children:" Dashboard: App"})}),e.jsx(Ne,{})]})}export{Ge as default};
