import{gX as pe,f0 as xe,j as e,K as v,G as m,fO as fe,ao as F,B as $,f as Z,r as l,U as ge,gY as je,m as be,A as we,gZ as ye,ah as ve,ai as Se,n as O,T as C,g as _e,h as w,b as Ce,c as Le,Q as Pe,d as Ie,a as Ae,i as Fe,o as Te,O as De,N as ke,g_ as $e,g$ as Ue,D as Re,C as Ee,aJ as Me,aK as Be,as as Ne,au as Oe,aA as p,az as a,S as K,h0 as qe,h1 as He,R as y,L as ze,k as We,l as Ge,h2 as Ye,W as Ke}from"./index-b5422eae.js";import{u as Je}from"./user-4a45e0ac.js";const Ve=pe(),Ze=Ve,Qe=xe(e.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"}),"CloudUpload"),Xe=v(m)`
  display: flex;
  align-items: center;
  justify-content: center;
`,es=v(fe)`
  display: block;
  text-align: center;
  align-items: center;
`,ss=v(F)`
  margin-top: 50px;
`,ts=v("div")`
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 70px;
  border-width: 2px;
  border-radius: 2px;
  border-color: ${n=>n.borderColor||"#eeeeee"};
  border-style: dashed;
  background-color: #102028;
  color: #bdbdbd;
  outline: none;
  transition: border 0.24s ease-in-out;
`,ns=v("ul")`
  list-style: none;
  padding: 0;
`,J=v($)`
  margin-top: ${({theme:n})=>n.spacing(2)};
  text-align: center;
`;v("div")`
  margin-top: ${({theme:n})=>n.spacing(2)};
  display: flex;
  flex-direction: column;
  gap: ${({theme:n})=>n.spacing(1)};
`;function as(){const n=Z(),[c,x]=l.useState([]),[g,t]=l.useState(""),[S,_]=l.useState(!1);let j=ge(["duetto_analytics/system/license","duetto_analytics/system/license_verify"]);l.useEffect(()=>(j&&j.on("message",(o,I)=>{const r=JSON.parse(I);console.log("license-message--->",r),x(A=>[...A,r]),r.status==="error"?(t(r.message),n.onFalse()):r.status==="success"&&(_(!0),n.onFalse()),o==="duetto_analytics/system/license"&&r.percent_completed===100&&(console.log("done--license-verify--->",r),window.location.reload())}),()=>{j&&(j.end(),j=null)}),[j]);const T=()=>{t(""),x([]),_(!1),n.onFalse()},U=o=>o.name.length>30?{code:"name-too-large",message:"Name is larger than 30 characters"}:null,{acceptedFiles:L,getRootProps:R,getInputProps:E,isFocused:P,isDragAccept:D,isDragReject:k}=je({maxFiles:1,validator:U,accept:{"application/x-enc":[".enc"],"application/octet-stream":[".enc"]},onDropAccepted:()=>{T(),n.onTrue()}}),M=l.useMemo(()=>{let o="#eeeeee";return P&&(o="#2196f3"),D&&(o="#00e676"),k&&(o="#ff1744"),{borderColor:o}},[P,D,k]),z=async()=>{if(n.value&&L.length>0)try{const o=new FormData;o.append("file",L[0]),await ye(o)}catch{t("Failed to upload license file"),n.onFalse()}};return e.jsx(Xe,{container:!0,spacing:2,children:e.jsx(es,{children:e.jsxs("section",{children:[e.jsxs(ts,{...R(M),children:[e.jsx("input",{...E()}),e.jsx(be,{color:"primary","aria-label":"upload license",component:"span",children:e.jsx(Qe,{style:{fontSize:95}})}),e.jsxs("p",{children:["Drag 'n' drop license file here, or ",e.jsx("b",{children:e.jsx("u",{children:"click here"})})," to select file"]})]}),e.jsxs("aside",{children:[e.jsx("h4",{children:"Selected License File"}),e.jsx(ns,{children:L.map(o=>e.jsxs("li",{children:[o.path," - ",(o.size/1024).toFixed(2)," KB"]},o.path))})]}),c.length>0&&e.jsx(J,{children:e.jsxs(we,{severity:g?"error":S?"success":"info",sx:{textAlign:"left"},children:[c[c.length-1].message,c[c.length-1].percent_completed&&e.jsxs($,{sx:{mt:1},children:["Progress: ",c[c.length-1].percent_completed,"%"]})]})}),g&&e.jsx(J,{children:e.jsx(F,{color:"primary",size:"small",onClick:T,children:"Try Again"})}),n.value&&!g&&!S&&e.jsx(ss,{variant:"contained",color:"primary",onClick:z,children:"Install License"})]})})})}var q={},os=Se;Object.defineProperty(q,"__esModule",{value:!0});var Q=q.default=void 0,rs=os(ve()),is=e,ls=(0,rs.default)((0,is.jsx)("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");Q=q.default=ls;const cs=O.div`
  flex-grow: 1;
  border-radius: 12px;
`,ds=O(C)`
  color: #367092;
  text-align: left;
  margin-left: 10px;
`,us=O.div`
  display: flex;
  justify-content: flex-end;
  width: 100%;
`,ms=_e().shape({first_name:w().required("First name is required"),last_name:w().required("Last name is required"),user_name:w().required("Username is required"),email:w().email("Email must be a valid email address").required("Email is required"),mobile:w(),password:w().test("password-length","Password must be at least 6 characters",function(n){return!n||n.length===0?!0:n.length>=6}),confirmPassword:w().test("passwords-match","Passwords must match",function(n){const{password:c}=this.parent;return!c||c.length===0?!0:n?n===c:!1})});function V({children:n,value:c,index:x,...g}){return e.jsx("div",{role:"tabpanel",hidden:c!==x,id:`about-tabpanel-${x}`,"aria-labelledby":`about-tab-${x}`,...g,children:c===x&&e.jsx($,{sx:{p:3},children:n})})}function hs(n){return{id:`about-tab-${n}`,"aria-controls":`about-tabpanel-${n}`}}function ps(){const n=Ce(),c=Le(),x=Pe(),{enqueueSnackbar:g}=Ie(),{user:t,isGuest:S}=Ae(),[_,H]=l.useState(0),[j,T]=l.useState(null),[U,L]=l.useState(null),[R,E]=l.useState(!1),[P,D]=l.useState(null),[k,M]=l.useState(null),[z,o]=l.useState(0),I=Z(!1),[r,A]=l.useState(null),[X,W]=l.useState(!1),G=Fe({resolver:Te(ms),defaultValues:{first_name:"",last_name:"",user_name:"",email:"",mobile:"",password:"",confirmPassword:""}}),{handleSubmit:ee,setValue:f,formState:{isSubmitting:se}}=G,te=()=>{ne({open:!1,dialogTitle:"",message:"",options:["No","Yes"]})},[xs,ne]=l.useState({message:"",dialogTitle:"",open:!1,options:["No","Yes"],onClose:te}),ae=async()=>{(await We()).length===0&&c(Ge)};l.useEffect(()=>{ae(),ie(),le()},[]),l.useEffect(()=>{t&&(t.id||t.user_id)&&B()},[t]);const B=async()=>{try{W(!0);const s=(t==null?void 0:t.id)||(t==null?void 0:t.user_id);if(!s)throw new Error("User ID not found");const i=await De.get(`${ke.user.get}${s}`),d=i.response||i;d?(A(d),N(d)):(A(t),N(t))}catch{A(t),N(t)}finally{W(!1)}},N=s=>{s&&(f("first_name",s.first_name||""),f("last_name",s.last_name||""),f("user_name",s.user_name||""),f("email",s.email||""),f("mobile",s.mobile||""),f("password",""),f("confirmPassword",""))},oe=async s=>{var i,d;try{const h={user_name:s.user_name,email:s.email,first_name:s.first_name,last_name:s.last_name,mobile:s.mobile||"",user_type:(r==null?void 0:r.user_type)||(t==null?void 0:t.user_type)||2,status:(r==null?void 0:r.status)||(t==null?void 0:t.status)||1};s.password&&s.password.trim()!==""&&(h.password=s.password);const u=(r==null?void 0:r.id)||(t==null?void 0:t.id)||(t==null?void 0:t.user_id);if(!u)throw new Error("User ID not found");await Je(u,h),g("Profile updated successfully",{variant:"success"}),f("password",""),f("confirmPassword",""),await B()}catch(h){const u=((d=(i=h.response)==null?void 0:i.data)==null?void 0:d.message)||h.message||"Failed to update profile";g(u,{variant:"error"})}},re=(s,i)=>{H(i),i===1&&t&&!r&&B()},ie=async()=>{const s=await $e();s&&s.mac_address&&T(s.mac_address.toUpperCase()),s&&s.host_id&&L(s.host_id)},le=async()=>{const{isLicensed:s,license:i,licensePlan:d}=await Ue();E(s),D(i),M(d)},ce=s=>{s===2&&I.onToggle(),o(s)},de=async()=>{try{const s=await Ye(),i=JSON.stringify(s,null,2),d=new Blob([i],{type:"application/json"}),h=window.URL.createObjectURL(d),u=document.createElement("a");u.href=h,u.download="host-info.json",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(h)}catch(s){console.error("Error downloading host info:",s)}};function Y(s){const i=new Date(s),d=i.getFullYear(),h=i.toLocaleString("default",{month:"long"}),u=i.getDate();let b=i.getHours();const me=i.getMinutes().toString().padStart(2,"0"),he=b>=12?"PM":"AM";return b=b%12,b=b||12,`${h} ${u}, ${d} ${b}:${me} ${he}`}const ue=S?[{value:0,label:"Device"}]:[{value:0,label:"Device"},{value:1,label:"User"}];return e.jsx(Ze,{maxWidth:x.themeStretch?!1:"xl",children:e.jsx($,{sx:{marginRight:2},children:e.jsxs(Re,{children:[e.jsx(Ee,{title:"About Duetto Analytics"}),e.jsx(Me,{value:_,onChange:re,sx:{px:2.5,boxShadow:s=>`inset 0 -2px 0 0 ${s.palette.divider}`},children:ue.map(s=>e.jsx(Be,{value:s.value,label:s.label,...hs(s.value)},s.value))}),e.jsxs(V,{value:_,index:0,children:[e.jsx(Ne,{"aria-label":"device information table",children:e.jsxs(Oe,{children:[e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Manufacturer"}),e.jsx(a,{align:"left",children:"Maestro Digital Mine"})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Contact Details"}),e.jsx(a,{align:"left",children:"87 Magill Street, Sudbury, ON, Canada P3Y 1K6"})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Software Version"}),e.jsx(a,{align:"left",children:"1.0.0"})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Software Released on"}),e.jsx(a,{align:"left",children:"2025-09-05"})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"MAC Address"}),e.jsx(a,{align:"left",children:j||""})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Host Id"}),e.jsx(a,{align:"left",children:U||""})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"License Status"}),e.jsx(a,{align:"left",children:"Active"})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"Activated On"}),e.jsx(a,{align:"left",children:Y(P.createdAt)})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"License Expires"}),e.jsx(a,{align:"left",children:Y(P.expiry_date)})]}),e.jsxs(p,{children:[e.jsx(a,{component:"th",scope:"row",children:"License Plan"}),e.jsx(a,{align:"left",children:k.code})]})]})]})}),I.value?e.jsxs(cs,{children:[e.jsx("br",{}),e.jsx(ds,{variant:"h6",gutterBottom:!0,children:"License Upload"}),e.jsx(as,{}),e.jsx("br",{}),e.jsx("br",{}),e.jsx(us,{children:e.jsx(F,{variant:"contained",color:"primary",component:"span",onClick:()=>I.onToggle(),children:"Exit"})})]}):!S&&e.jsxs(K,{direction:"row",alignItems:"center",spacing:1,sx:{mt:3},children:[e.jsx(F,{variant:"contained",sx:{backgroundColor:n.palette.primary.dark,color:"#fff"},component:"span",startIcon:e.jsx(qe,{}),onClick:()=>de(),children:"Download Host Info"}),e.jsx(F,{variant:"contained",sx:{backgroundColor:n.palette.primary.dark,color:"#fff"},component:"span",startIcon:e.jsx(Q,{}),onClick:()=>ce(2),children:"Upload License"})]})]}),!S&&e.jsx(V,{value:_,index:1,children:t?X?e.jsx(C,{children:"Loading user information..."}):e.jsx(He,{...G,children:e.jsx("form",{onSubmit:ee(oe),children:e.jsxs(m,{container:!0,spacing:3,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Profile Information"})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"first_name",label:"First Name",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"last_name",label:"Last Name",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"user_name",label:"Username",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"email",label:"Email",type:"email",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"mobile",label:"Mobile Number",fullWidth:!0})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(C,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:"Change Password"}),e.jsx(C,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Leave blank to keep current password"})]}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"password",label:"New Password",type:"password",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,sm:6,children:e.jsx(y,{name:"confirmPassword",label:"Confirm New Password",type:"password",fullWidth:!0})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(K,{direction:"row",justifyContent:"flex-end",sx:{mt:3},children:e.jsx(ze,{type:"submit",variant:"contained",color:"primary",loading:se,size:"large",children:"Save"})})})]})})}):e.jsx(C,{color:"error",children:"No user authentication found. Please log in again."})})]})})})}function js(){return e.jsxs(e.Fragment,{children:[e.jsx(Ke,{children:e.jsx("title",{children:"About"})}),e.jsx(ps,{})]})}export{js as default};
